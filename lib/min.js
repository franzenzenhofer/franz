var ImageFilters={utils:{initSampleCanvas:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=0;a.height=0;ImageFilters.getSamplecanvas=function(){return a};this.getSampleContext=function(){return b};this.createImageData=b.createImageData?function(a,f){return b.createImageData(a,f)}:function(a,b){return new ImageData(a,b)}},getSampleCanvas:function(){this.initSampleCanvas();return ImageFilters.getSamplecanvas()},getSampleContext:function(){this.initSampleCanvas();return this.getSampleContext()},
createImageData:function(a,b){this.initSampleCanvas();return this.createImageData(a,b)},clamp:function(a){return 255<a?255:0>a?0:a},buildMap:function(a){for(var b=[],c=0,f;256>c;c+=1)b[c]=255<(f=a(c))?255:0>f?0:f|0;return b},applyMap:function(a,b,c){for(var f=0,h=a.length;f<h;f+=4)b[f]=c[a[f]],b[f+1]=c[a[f+1]],b[f+2]=c[a[f+2]],b[f+3]=a[f+3]},mapRGB:function(a,b,c){this.applyMap(a,b,this.buildMap(c))},getPixelIndex:function(a,b,c,f,h){if(0>a||a>=c||0>b||b>=f)switch(h){case 1:a=0>a?0:a>=c?c-1:a;b=0>
b?0:b>=f?f-1:b;break;case 2:a=0>(a%=c)?a+c:a;b=0>(b%=f)?b+f:b;break;default:return null}return b*c+a<<2},getPixel:function(a,b,c,f,h,i){if(0>b||b>=f||0>c||c>=h)switch(i){case 1:b=0>b?0:b>=f?f-1:b;c=0>c?0:c>=h?h-1:c;break;case 2:b=0>(b%=f)?b+f:b;c=0>(c%=h)?c+h:c;break;default:return 0}b=c*f+b<<2;return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},getPixelByIndex:function(a,b){return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},copyBilinear:function(a,b,c,f,h,i,k,o){var g=0>b?b-1|0:b|0,p=0>c?c-1|0:c|0,b=b-g,c=c-
p,n,m=0,j=0,q=0;n=0;if(0<=g&&g<f-1&&0<=p&&p<h-1)if(n=p*f+g<<2,b||c)m=a[n+3]<<24|a[n]<<16|a[n+1]<<8|a[n+2],n+=4,j=a[n+3]<<24|a[n]<<16|a[n+1]<<8|a[n+2],n=n-8+(f<<2),q=a[n+3]<<24|a[n]<<16|a[n+1]<<8|a[n+2],n+=4,n=a[n+3]<<24|a[n]<<16|a[n+1]<<8|a[n+2];else{i[k]=a[n];i[k+1]=a[n+1];i[k+2]=a[n+2];i[k+3]=a[n+3];return}else if(m=this.getPixel(a,g,p,f,h,o),b||c)j=this.getPixel(a,g+1,p,f,h,o),q=this.getPixel(a,g,p+1,f,h,o),n=this.getPixel(a,g+1,p+1,f,h,o);else{i[k]=m>>16&255;i[k+1]=m>>8&255;i[k+2]=m&255;i[k+3]=
m>>24&255;return}o=1-b;g=1-c;a=((m>>16&255)*o+(j>>16&255)*b)*g+((q>>16&255)*o+(n>>16&255)*b)*c;f=((m>>8&255)*o+(j>>8&255)*b)*g+((q>>8&255)*o+(n>>8&255)*b)*c;h=((m&255)*o+(j&255)*b)*g+((q&255)*o+(n&255)*b)*c;b=((m>>24&255)*o+(j>>24&255)*b)*g+((q>>24&255)*o+(n>>24&255)*b)*c;i[k]=255<a?255:0>a?0:a|0;i[k+1]=255<f?255:0>f?0:f|0;i[k+2]=255<h?255:0>h?0:h|0;i[k+3]=255<b?255:0>b?0:b|0},rgbToHsl:function(a,b,c){var a=a/255,b=b/255,c=c/255,f=a>b?a>c?a:c:b>c?b:c,h=a<b?a<c?a:c:b<c?b:c,i=f-h,k=0,o=0,g=(h+f)/2;
0!==i&&(k=(a===f?(b-c)/i+(b<c?6:0):b===f?(c-a)/i+2:(a-b)/i+4)/6,o=0.5<g?i/(2-f-h):i/(f+h));return[k,o,g]},hslToRgb:function(a,b,c){var f;f=[];if(0===b)f=b=c=255*c+0.5|0,f=[f,b,c];else for(var b=0.5>=c?c*(b+1):c+b-c*b,c=2*c-b,a=a+1/3,h,i=0;3>i;i+=1)0>a?a+=1:1<a&&(a-=1),h=1>6*a?c+6*(b-c)*a:1>2*a?b:2>3*a?c+6*(b-c)*(2/3-a):c,f[i]=255*h+0.5|0,a-=1/3;return f}},Translate:function(){},Scale:function(){},Rotate:function(){},Affine:function(){},UnsharpMask:function(){},ConvolutionFilter:function(a,b,c,f,h,
i,k,o,g,p){var n=a.data,m=a.width,a=a.height,j=ImageFilters.utils.createImageData(m,a),q=j.data,h=h||1,i=i||0;!1!==k&&(k=!0);!1!==o&&(o=!0);for(var g=g||0,s=0,b=b>>1,c=c>>1,r=g>>16&255,l=g>>8&255,g=g&255,p=255*(p||0),d=0;d<a;d+=1)for(var e=0;e<m;e+=1,s+=4){for(var v=0,u=0,C=0,A=0,E=!1,I=0,H,G=-b;G<=b;G+=1){var D=d+G,F;0<=D&&D<a?F=D*m:o?F=d*m:E=!0;for(D=-c;D<=c;D+=1){var z=f[I++];if(0!==z){var w=e+D;0<=w&&w<m||(o?w=e:E=!0);E?(v+=z*r,u+=z*l,C+=z*g,A+=z*p):(w=F+w<<2,v+=z*n[w],u+=z*n[w+1],C+=z*n[w+2],
A+=z*n[w+3])}}}q[s]=255<(H=v/h+i)?255:0>H?0:H|0;q[s+1]=255<(H=u/h+i)?255:0>H?0:H|0;q[s+2]=255<(H=C/h+i)?255:0>H?0:H|0;q[s+3]=k?n[s+3]:255<(H=A/h+i)?255:0>H?0:H|0}return j},Binarize:function(a,b){var c=a.data,f=c.length,h=ImageFilters.utils.createImageData(a.width,a.height),i=h.data;isNaN(b)&&(b=0.5);for(var b=255*b,k=0;k<f;k+=4)i[k]=i[k+1]=i[k+2]=c[k]+c[k+1]+c[k+2]/3<=b?0:255,i[k+3]=255;return h},BlendAdd:function(a,b){for(var c=a.data,f=c.length,h=ImageFilters.utils.createImageData(a.width,a.height),
i=h.data,k=b.data,o,g=0;g<f;g+=4)i[g]=255<(o=c[g]+k[g])?255:o,i[g+1]=255<(o=c[g+1]+k[g+1])?255:o,i[g+2]=255<(o=c[g+2]+k[g+2])?255:o,i[g+3]=255;return h},BlendSubtract:function(a,b){for(var c=a.data,f=c.length,h=ImageFilters.utils.createImageData(a.width,a.height),i=h.data,k=b.data,o,g=0;g<f;g+=4)i[g]=0>(o=c[g]-k[g])?0:o,i[g+1]=0>(o=c[g+1]-k[g+1])?0:o,i[g+2]=0>(o=c[g+2]-k[g+2])?0:o,i[g+3]=255;return h}};
ImageFilters.BoxBlur=function(){var a=function(a,c,f,h,i){var k=2*i+1,o=i+1,g=f-1,p,n,m,j=0,q,s,r,l,d,e=[];l=0;for(p=256*k;l<p;l+=1)e[l]=l/k|0;for(d=0;d<h;d+=1){k=p=n=m=0;q=d;s=j<<2;k+=o*a[s];p+=o*a[s+1];n+=o*a[s+2];m+=o*a[s+3];for(l=1;l<=i;l+=1)s=j+(l<f?l:g)<<2,k+=a[s],p+=a[s+1],n+=a[s+2],m+=a[s+3];for(l=0;l<f;l+=1)s=q<<2,c[s]=e[k],c[s+1]=e[p],c[s+2]=e[n],c[s+3]=e[m],s=l+o,s>g&&(s=g),r=l-i,0>r&&(r=0),s=j+s<<2,r=j+r<<2,k+=a[s]-a[r],p+=a[s+1]-a[r+1],n+=a[s+2]-a[r+2],m+=a[s+3]-a[r+3],q+=h;j+=f}};return function(b,
c,f,h){for(var i=b.data,k=b.width,b=b.height,o=ImageFilters.utils.createImageData(k,b),g=o.data,p=ImageFilters.utils.createImageData(k,b).data,n=0;n<h;n+=1)a(n?g:i,p,k,b,c),a(p,g,b,k,f);return o}}();
ImageFilters.GaussianBlur=function(a,b){var c,f,h;switch(b){case 2:c=5;f=[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1];h=52;break;case 3:c=7;f=[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1];h=140;break;case 4:c=15;f=[2,2,3,4,5,5,6,6,6,5,5,4,3,2,2,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,6,8,10,13,15,
17,19,19,19,17,15,13,10,8,6,6,8,11,13,16,18,19,20,19,18,16,13,11,8,6,6,8,10,13,15,17,19,19,19,17,15,13,10,8,6,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,2,2,3,4,5,5,6,6,6,5,5,4,3,2,2];h=2044;break;default:c=3,f=[1,2,1,2,4,2,1,2,1],h=16}return ImageFilters.ConvolutionFilter(a,c,c,f,h,0,!1)};
ImageFilters.StackBlur=function(){function a(){this.a=this.b=this.g=this.r=0;this.next=null}var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,
404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,
323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(f,h){var i=f.width,k=f.height,o=ImageFilters.Clone(f),g=o.data,p,n,m,j,q,s,r,l,d,e,v,u,C,A,E,I,H,G,D,F,z,w,
B;p=h+h+1;var O=i-1,P=k-1,J=h+1,K=J*(J+1)/2,L=new a,t=L,Q,N=b[h],M=c[h];for(m=1;m<p;m+=1)t=t.next=new a,m==J&&(Q=t);t.next=L;for(n=s=q=0;n<k;n+=1){E=I=H=G=r=l=d=e=0;v=J*(D=g[q]);u=J*(F=g[q+1]);C=J*(z=g[q+2]);A=J*(w=g[q+3]);r+=K*D;l+=K*F;d+=K*z;e+=K*w;t=L;for(m=0;m<J;m+=1)t.r=D,t.g=F,t.b=z,t.a=w,t=t.next;for(m=1;m<J;m+=1)j=q+((O<m?O:m)<<2),r+=(t.r=D=g[j])*(B=J-m),l+=(t.g=F=g[j+1])*B,d+=(t.b=z=g[j+2])*B,e+=(t.a=w=g[j+3])*B,E+=D,I+=F,H+=z,G+=w,t=t.next;m=L;t=Q;for(p=0;p<i;p+=1)g[q]=r*N>>M,g[q+1]=l*N>>
M,g[q+2]=d*N>>M,g[q+3]=e*N>>M,r-=v,l-=u,d-=C,e-=A,v-=m.r,u-=m.g,C-=m.b,A-=m.a,j=s+((j=p+h+1)<O?j:O)<<2,E+=m.r=g[j],I+=m.g=g[j+1],H+=m.b=g[j+2],G+=m.a=g[j+3],r+=E,l+=I,d+=H,e+=G,m=m.next,v+=D=t.r,u+=F=t.g,C+=z=t.b,A+=w=t.a,E-=D,I-=F,H-=z,G-=w,t=t.next,q+=4;s+=i}for(p=0;p<i;p+=1){I=H=G=E=l=d=e=r=0;q=p<<2;v=J*(D=g[q]);u=J*(F=g[q+1]);C=J*(z=g[q+2]);A=J*(w=g[q+3]);r+=K*D;l+=K*F;d+=K*z;e+=K*w;t=L;for(m=0;m<J;m+=1)t.r=D,t.g=F,t.b=z,t.a=w,t=t.next;j=i;for(m=1;m<=h;m+=1)q=j+p<<2,r+=(t.r=D=g[q])*(B=J-m),l+=
(t.g=F=g[q+1])*B,d+=(t.b=z=g[q+2])*B,e+=(t.a=w=g[q+3])*B,E+=D,I+=F,H+=z,G+=w,t=t.next,m<P&&(j+=i);q=p;m=L;t=Q;for(n=0;n<k;n+=1)j=q<<2,g[j]=r*N>>M,g[j+1]=l*N>>M,g[j+2]=d*N>>M,g[j+3]=e*N>>M,r-=v,l-=u,d-=C,e-=A,v-=m.r,u-=m.g,C-=m.b,A-=m.a,j=p+((j=n+J)<P?j:P)*i<<2,r+=E+=m.r=g[j],l+=I+=m.g=g[j+1],d+=H+=m.b=g[j+2],e+=G+=m.a=g[j+3],m=m.next,v+=D=t.r,u+=F=t.g,C+=z=t.b,A+=w=t.a,E-=D,I-=F,H-=z,G-=w,t=t.next,q+=i}return o}}();
ImageFilters.Brightness=function(a,b){var c=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(c,f.data,function(a){a+=b;return 255<a?255:a});return f};
ImageFilters.BrightnessContrastGimp=function(a,b,c){for(var f=a.data,h=f.length,a=ImageFilters.utils.createImageData(a.width,a.height),i=a.data,k=Math.PI/4,b=b/100,c=0.99*c,c=c/100,c=Math.tan((c+1)*k),o=0,k=0;k<h;k+=4)o+=19595*f[k]+38470*f[k+1]+7471*f[k+2]>>16;o/=h/4;ImageFilters.utils.mapRGB(f,i,function(a){0>b?a*=1+b:0<b&&(a+=(255-a)*b);0!==c&&(a=(a-o)*c+o);return a+0.5|0});return a};
ImageFilters.BrightnessContrastPhotoshop=function(a,b,c){var f=a.data,a=ImageFilters.utils.createImageData(a.width,a.height),h=a.data,b=(b+100)/100,c=(c+100)/100;ImageFilters.utils.mapRGB(f,h,function(a){a*=b;a=(a-127.5)*c+127.5;return a+0.5|0});return a};
ImageFilters.Channels=function(a,b){var c;switch(b){case 2:c=[0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0];break;case 3:c=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0];break;default:c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0]}return this.ColorMatrixFilter(a,c)};ImageFilters.Clone=function(a){return this.Copy(a,ImageFilters.utils.createImageData(a.width,a.height))};
ImageFilters.CloneBuiltin=function(a){var b=a.width,c=a.height,f=ImageFilters.utils.getSampleCanvas(),h=ImageFilters.utils.getSampleContext();f.width=b;f.height=c;h.putImageData(a,0,0);a=h.getImageData(0,0,b,c);f.width=0;f.height=0;return a};
ImageFilters.ColorMatrixFilter=function(a,b){var c=a.data,f=c.length,h=ImageFilters.utils.createImageData(a.width,a.height),i=h.data,k=b[0],o=b[1],g=b[2],p=b[3],n=b[4],m=b[5],j=b[6],q=b[7],s=b[8],r=b[9],l=b[10],d=b[11],e=b[12],v=b[13],u=b[14],C=b[15],A=b[16],E=b[17],I=b[18],H=b[19],G,D,F,z,w,B;for(D=0;D<f;D+=4)F=c[D],z=c[D+1],w=c[D+2],B=c[D+3],i[D]=255<(G=F*k+z*o+w*g+B*p+n)?255:0>G?0:G|0,i[D+1]=255<(G=F*m+z*j+w*q+B*s+r)?255:0>G?0:G|0,i[D+2]=255<(G=F*l+z*d+w*e+B*v+u)?255:0>G?0:G|0,i[D+3]=255<(G=F*
C+z*A+w*E+B*I+H)?255:0>G?0:G|0;return h};ImageFilters.ColorTransformFilter=function(a,b,c,f,h,i,k,o,g){var p=a.data,n=p.length,a=ImageFilters.utils.createImageData(a.width,a.height),m=a.data,j,q;for(j=0;j<n;j+=4)m[j]=255<(q=p[j]*b+i)?255:0>q?0:q,m[j+1]=255<(q=p[j+1]*c+k)?255:0>q?0:q,m[j+2]=255<(q=p[j+2]*f+o)?255:0>q?0:q,m[j+3]=255<(q=p[j+3]*h+g)?255:0>q?0:q;return a};ImageFilters.Copy=function(a,b){for(var c=a.data,f=c.length,h=b.data;f--;)h[f]=c[f];return b};
ImageFilters.Crop=function(a,b,c,f,h){var i=a.data,k=a.width,o=a.height,a=ImageFilters.utils.createImageData(f,h),g=a.data,p=Math.max(b,0),n=Math.max(c,0),m=Math.min(b+f,k),h=Math.min(c+h,o),b=p-b,j,o=n;for(dstRow=n-c;o<h;o+=1,dstRow+=1){c=p;for(dstCol=b;c<m;c+=1,dstCol+=1)n=o*k+c<<2,j=dstRow*f+dstCol<<2,g[j]=i[n],g[j+1]=i[n+1],g[j+2]=i[n+2],g[j+3]=i[n+3]}return a};
ImageFilters.CropBuiltin=function(a,b,c,f,h){var i=a.width,k=a.height,o=ImageFilters.utils.getSampleCanvas(),g=ImageFilters.utils.getSampleContext();o.width=i;o.height=k;g.putImageData(a,0,0);a=g.getImageData(b,c,f,h);o.width=0;o.height=0;return a};
ImageFilters.Desaturate=function(a){for(var b=a.data,c=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h=0;h<c;h+=4){var i=b[h],k=b[h+1],o=b[h+2];f[h]=f[h+1]=f[h+2]=((i>k?i>o?i:o:k>o?k:o)+(i<k?i<o?i:o:k<o?k:o))/2+0.5|0;f[h+3]=b[h+3]}return a};
ImageFilters.DisplacementMapFilter=function(a,b,c,f,h,i,k,o,g){var p=a.data,n=a.width,m=a.height,a=ImageFilters.Clone(a),j=a.data;c||(c=0);f||(f=0);h||(h=0);i||(i=0);k||(k=0);o||(o=0);g||(g=2);var q=b.width,s=b.data,r=q+c,b=b.height+f,l,d,e,v,u;for(v=0;v<n;v+=1)for(u=0;u<m;u+=1)l=u*n+v<<2,v<c||u<f||v>=r||u>=b?d=l:(e=(u-f)*q+(v-c)<<2,d=s[e+h],d=v+((d-128)*k>>8),e=s[e+i],e=u+((e-128)*o>>8),d=ImageFilters.utils.getPixelIndex(d+0.5|0,e+0.5|0,n,m,g),null===d&&(d=l)),j[l]=p[d],j[l+1]=p[d+1],j[l+2]=p[d+
2],j[l+3]=p[d+3];return a};
ImageFilters.Dither=function(a,b){var c=a.width,f=a.height,h=ImageFilters.Clone(a),i=h.data,b=2>b?2:255<b?255:b,k,o=[];k=b-1;var g=0,p=0,n;for(n=0;n<b;n+=1)o[n]=255*n/k;k=ImageFilters.utils.buildMap(function(){var a=o[g];p+=b;255<p&&(p-=255,g+=1);return a});var m,j,q,s,r,l,d,e,v=c-1,u=f-1;for(m=0;m<f;m+=1)for(n=0;n<c;n+=1)if(j=m*c+n<<2,q=i[j],s=i[j+1],r=i[j+2],l=k[q],d=k[s],e=k[r],i[j]=l,i[j+1]=d,i[j+2]=e,q-=l,s-=d,r-=e,j+=4,n<v&&(e=i[j]+0.4375*q,d=i[j+1]+0.4375*s,l=i[j+2]+0.4375*r,i[j]=255<e?255:
0>e?0:e|0,i[j+1]=255<d?255:0>d?0:d|0,i[j+2]=255<l?255:0>l?0:l|0),j+=c-2<<2,0<n&&m<u&&(e=i[j]+0.1875*q,d=i[j+1]+0.1875*s,l=i[j+2]+0.1875*r,i[j]=255<e?255:0>e?0:e|0,i[j+1]=255<d?255:0>d?0:d|0,i[j+2]=255<l?255:0>l?0:l|0),j+=4,m<u&&(e=i[j]+0.3125*q,d=i[j+1]+0.3125*s,l=i[j+2]+0.3125*r,i[j]=255<e?255:0>e?0:e|0,i[j+1]=255<d?255:0>d?0:d|0,i[j+2]=255<l?255:0>l?0:l|0),j+=4,n<v&&m<u)e=i[j]+0.0625*q,d=i[j+1]+0.0625*s,l=i[j+2]+0.0625*r,i[j]=255<e?255:0>e?0:e|0,i[j+1]=255<d?255:0>d?0:d|0,i[j+2]=255<l?255:0>l?0:
l|0;return h};ImageFilters.Edge=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-1,-1,-1,-1,8,-1,-1,-1,-1])};ImageFilters.Emboss=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-2,-1,0,-1,1,1,0,1,2])};ImageFilters.Enrich=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[0,-2,0,-2,20,-2,0,-2,0],10,-40)};
ImageFilters.Flip=function(a,b){var c=a.data,f=a.width,h=a.height,i=ImageFilters.utils.createImageData(f,h),k=i.data,o,g,p,n;for(g=0;g<h;g+=1)for(o=0;o<f;o+=1)p=g*f+o<<2,n=b?(h-g-1)*f+o<<2:g*f+(f-o-1)<<2,k[n]=c[p],k[n+1]=c[p+1],k[n+2]=c[p+2],k[n+3]=c[p+3];return i};ImageFilters.Gamma=function(a,b){var c=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(c,f.data,function(a){a=255*Math.pow(a/255,1/b)+0.5;return 255<a?255:a+0.5|0});return f};
ImageFilters.GrayScale=function(a){for(var b=a.data,c=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h=0;h<c;h+=4)f[h]=f[h+1]=f[h+2]=19595*b[h]+38470*b[h+1]+7471*b[h+2]>>16,f[h+3]=b[h+3];return a};
ImageFilters.HSLAdjustment=function(a,b,c,f){var h=a.data,i=h.length,a=ImageFilters.utils.createImageData(a.width,a.height),k=a.data,b=b/360,c=c/100,f=f/100,o=ImageFilters.utils.rgbToHsl,g=ImageFilters.utils.hslToRgb,p,n,m,j;for(j=0;j<i;j+=4){m=o(h[j],h[j+1],h[j+2]);for(p=m[0]+b;0>p;)p+=1;for(;1<p;)p-=1;n=m[1]+m[1]*c;0>n?n=0:1<n&&(n=1);m=m[2];0<f?m+=(1-m)*f:0>f&&(m+=m*f);p=g(p,n,m);k[j]=p[0];k[j+1]=p[1];k[j+2]=p[2];k[j+3]=h[j+3]}return a};
ImageFilters.Invert=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 255-a});return a};
ImageFilters.Mosaic=function(a,b){var c=a.data,f=a.width,h=a.height,i=ImageFilters.utils.createImageData(f,h),k=i.data,o=Math.ceil(f/b),g=Math.ceil(h/b),p,n,m,j,q,s,r,l,d,e,v,u,C,A,E;for(p=0;p<g;p+=1){q=p*b;s=q+b;s>h&&(s=h);for(n=0;n<o;n+=1){m=n*b;j=m+b;j>f&&(j=f);u=C=A=E=0;v=(j-m)*(s-q);for(l=q;l<s;l+=1){d=l*f;for(r=m;r<j;r+=1)e=d+r<<2,u+=c[e],C+=c[e+1],A+=c[e+2],E+=c[e+3]}u=u/v+0.5|0;C=C/v+0.5|0;A=A/v+0.5|0;E=E/v+0.5|0;for(l=q;l<s;l+=1){d=l*f;for(r=m;r<j;r+=1)e=d+r<<2,k[e]=u,k[e+1]=C,k[e+2]=A,k[e+
3]=E}}}return i};
ImageFilters.Oil=function(a,b,c){var f=a.data,h=a.width,a=a.height,i=ImageFilters.utils.createImageData(h,a),k=i.data,o=0,g=[],p=[],n=[],m=[],j=[],q=[],s,r,l,d,e,v,u,C,A,E,I;for(r=0;r<a;r+=1)for(s=0;s<h;s+=1){for(l=0;l<c;l+=1)g[l]=p[l]=n[l]=m[l]=j[l]=q[l]=0;for(l=-b;l<=b;l+=1)if(d=r+l,!(0>d||d>=a)){v=d*h;for(d=-b;d<=b;d+=1)e=s+d,0>e||e>=h||(u=v+e<<2,e=f[u],C=f[u+1],u=f[u+2],A=e*c>>8,E=C*c>>8,I=u*c>>8,m[A]+=e,j[E]+=C,q[I]+=u,g[A]+=1,p[E]+=1,n[I]+=1)}d=v=e=0;for(l=1;l<c;l+=1)g[l]>g[d]&&(d=l),p[l]>p[v]&&
(v=l),n[l]>n[e]&&(e=l);k[o]=m[d]/g[d]|0;k[o+1]=j[v]/p[v]|0;k[o+2]=q[e]/n[e]|0;k[o+3]=f[o+3];o+=4}return i};ImageFilters.OpacityFilter=function(a,b){for(var c=a.data,f=c.length,h=ImageFilters.utils.createImageData(a.width,a.height),i=h.data,k=0;k<f;k+=4)i[k]=c[k],i[k+1]=c[k+1],i[k+2]=c[k+2],i[k+3]=b;return h};
ImageFilters.Posterize=function(a,b){var c=a.data,f=ImageFilters.utils.createImageData(a.width,a.height),h=f.data,b=2>b?2:255<b?255:b,i=[],k=b-1,o=0,g=0,p;for(p=0;p<b;p+=1)i[p]=255*p/k;ImageFilters.utils.mapRGB(c,h,function(){var a=i[o];g+=b;255<g&&(g-=255,o+=1);return a});return f};ImageFilters.Rescale=function(a,b){var c=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(c,f.data,function(a){a*=b;return 255<a?255:a+0.5|0});return f};
ImageFilters.ResizeNearestNeighbor=function(a,b,c){var f=a.data,h=a.width,i=a.height,a=ImageFilters.utils.createImageData(b,c),k=a.data,o=h/b,i=i/c,g=0,p,n,m,j;for(m=0;m<c;m+=1){j=(m*i|0)*h;for(n=0;n<b;n+=1)p=j+n*o<<2,k[g]=f[p],k[g+1]=f[p+1],k[g+2]=f[p+2],k[g+3]=f[p+3],g+=4}return a};
ImageFilters.Resize=function(a,b,c){var f=a.data,h=a.width,a=a.height,i=ImageFilters.utils.createImageData(b,c),k=i.data,o=h/b,g=a/c,p=0,n,m;for(m=0;m<c;m+=1)for(n=0;n<b;n+=1)ImageFilters.utils.copyBilinear(f,n*o,m*g,h,a,k,p,0),p+=4;return i};
ImageFilters.ResizeBuiltin=function(a,b,c){var f=a.width,h=a.height,i=ImageFilters.utils.getSampleCanvas(),k=ImageFilters.utils.getSampleContext();i.width=Math.max(f,b);i.height=Math.max(h,c);k.save();k.putImageData(a,0,0);k.scale(b/f,c/h);k.drawImage(i,0,0);a=k.getImageData(0,0,b,c);k.restore();i.width=0;i.height=0;return a};
ImageFilters.Sepia=function(a){var b=a.data,c=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,h,i,k,o,g;for(o=0;o<c;o+=4)h=b[o],i=b[o+1],k=b[o+2],f[o]=255<(g=0.393*h+0.769*i+0.189*k)?255:0>g?0:g+0.5|0,f[o+1]=255<(g=0.349*h+0.686*i+0.168*k)?255:0>g?0:g+0.5|0,f[o+2]=255<(g=0.272*h+0.534*i+0.131*k)?255:0>g?0:g+0.5|0,f[o+3]=b[o+3];return a};ImageFilters.Sharpen=function(a,b){return ImageFilters.ConvolutionFilter(a,3,3,[-b/16,-b/8,-b/16,-b/8,0.75*b+1,-b/8,-b/16,-b/8,-b/16])};
ImageFilters.Solarize=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 127<a?2*(a-127.5):2*(127.5-a)});return a};ImageFilters.Transpose=function(a){var b=a.data,c=a.width,a=a.height,f=ImageFilters.utils.createImageData(a,c),h=f.data,i,k;for(y=0;y<a;y+=1)for(x=0;x<c;x+=1)i=y*c+x<<2,k=x*a+y<<2,h[k]=b[i],h[k+1]=b[i+1],h[k+2]=b[i+2],h[k+3]=b[i+3];return f};
ImageFilters.Twril=function(a,b,c,f,h,i,k){var o=a.data,g=a.width,a=a.height,p=ImageFilters.utils.createImageData(g,a),n=p.data,b=g*b,c=a*c,h=h*(Math.PI/180),m=f*f,j=0,q,s,r,l,d;for(s=0;s<a;s+=1)for(q=0;q<g;q+=1)r=q-b,l=s-c,d=r*r+l*l,d>m?(n[j]=o[j],n[j+1]=o[j+1],n[j+2]=o[j+2],n[j+3]=o[j+3]):(d=Math.sqrt(d),l=Math.atan2(l,r)+h*(f-d)/f,r=b+d*Math.cos(l),d=c+d*Math.sin(l),k?ImageFilters.utils.copyBilinear(o,r,d,g,a,n,j,i):(d=(d+0.5|0)*g+(r+0.5|0)<<2,n[j]=o[d],n[j+1]=o[d+1],n[j+2]=o[d+2],n[j+3]=o[d+3])),
j+=4;return p};(function(){var a,b,c,f,h,i,k,o,g,p,n,m,j,q,s,r=[].slice;a={};window.Franz=a;a._DEBUG_=!0;h=function(a){return console.log(a)};b=function(a,d){for(;!a;)throw Error("Callback required for "+d);return[]};n=function(a){var d;d=[];return a&&"[object Function]"===d.toString.apply(a)};q=function(){var a,d;a=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];a&&n(a)&&window.setTimeout.apply(window,[a,0].concat(r.call(d)));return null!=d?d[0]:void 0};i=function(){var a,d,e,v,b,c,i,f,g;c=arguments[0];
d=2<=arguments.length?r.call(arguments,1):[];e=null;b=[];v=0;i=function(a){return n(a)&&!e?e=a:b.push(a)};f=0;for(g=c.length;f<g;f++)a=c[f],i(a);c=function(a){var l;return null!=(l=b[v])?l:b[v]=a};v=i=0;for(f=d.length;i<f;v=++i)a=d[v],c(a);e||(e=function(){return null});b.unshift(e);return b};k=function(){var a,d,e,b,c,i,f,g,h;i=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];e=null;c=[];b=0;f=function(a){return n(a)&&!e?e=a:c.push(a)};g=0;for(h=i.length;g<h;g++)a=i[g],f(a);i=function(a){var l;
return null!=(l=c[b])?l:c[b]=a};b=f=0;for(g=d.length;f<g;b=++f)a=d[b],i(a);e||(e=!1);c.unshift(e);return c};p=function(){var a,d,e,b,c,i,f;a=arguments[0];d=arguments[1];e=arguments[2];i=4<=arguments.length?r.call(arguments,3):[];f=g(a);a=f[0];b=f[2];f=s(a);a=f[0];c=f[1];q(function(){return c.putImageData(e.apply(null,[b].concat(r.call(i))),0,0)});return q(d,a)};m=function(){var a,d;d=arguments[0];a=2<=arguments.length?r.call(arguments,1):[];return function(){var e,b,c;e=arguments[0];b=2<=arguments.length?
r.call(arguments,1):[];c=i(b,a);b=c.shift();return p.apply(null,[e,b,d].concat(r.call(c)))}};a.clamp=c=function(a,d,e){null==d&&(d=0);null==e&&(e=255);return Math.min(e,Math.max(d,a))};a.getToolbox=g=function(a,d){var e,b;return q(d,[a,e=a.getContext("2d"),b=e.getImageData(0,0,a.width,a.height),b.data])};a.make=j=function(){var a,d,e,b,c;d=1<=arguments.length?r.call(arguments,0):[];a=i(d,800,600);d=a[0];c=a[1];e=a[2];b=a[3];c.width&&c.height&&(a=c,c=a.width,e=a.height,b=(null!=a?"function"===typeof a.getAttribute?
a.getAttribute("id"):void 0:void 0)||(null!=a?"function"===typeof a.getAttribute?a.getAttribute("origin"):void 0:void 0));a=document.createElement("canvas");a.width=c;a.height=e;b&&a.setAttribute("origin",b);return q(d,a)};a.newToolbox=s=function(){var l,d;l=1<=arguments.length?r.call(arguments,0):[];d=i(l);l=d[0];return a.getToolbox(j(d[1],d[2],d[3]),l)};a.copy=f=function(l,d){var e,b;b=a.newToolbox(l);e=b[0];b[1].drawImage(l,0,0,l.width,l.height);return q(d,e)};a.byImage=function(l,d){if(l.width&&
l.height)return f(l,d);b(d,'Franz.byImage (only if the image is not "loaded")');n(d)&&(l.onload=function(){return a.byImage(l,d)});return!0};a.byArray=function(a,d,e,b){var c,i,f;c=s(d,e);d=c[0];e=c[1];i=c[2];f=c[3];for(c=0;c<f.length;)f[c]=a[c],c+=1;e.putImageData(i,0,0);return q(b,d)};a.toImage=function(){var a,d,e,b;a=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];e=i(d,"image/png");d=e[0];b=e[1];e=new Image;e.src=a.toDataURL(b,"");return q(d,e)};a.toArray=function(a){var d,e;d=[];e=
g(a)[3];Uint8Array&&(d=new Uint8Array(new ArrayBuffer(e.length)));for(a=0;a<e.length;)d[a]=e[a],a+=1;return d};a.rgba=function(){var l,d,e,b,c,f,A,h,k,j,m,o,p,s,w,B;e=arguments[0];b=2<=arguments.length?r.call(arguments,1):[];c=i(b,null,!1);b=c[0];f=c[1];c=c[2];if(!n(f))return!1;j=g(e);e=j[0];j=j[3];l=[e.width,e.height];p=l[0];h=l[1];o=new Uint8Array(new ArrayBuffer(j.length));for(w=0;w<h;){s=0;for(B=w*p;s<p;)m=k=4*(B+s),A=k+1,d=k+2,l=k+3,k=c?f(j[m],j[A],j[d],j[l],k,e):f(j[m],j[A],j[d],j[l],k),o[m]=
k[0],o[A]=k[1],o[d]=k[2],o[l]=k[3],s+=1;w+=1}e=a.byArray(o,p,h);return q(b,e)};a.getGrayscaleValue=o=function(a,d,e){return 0.3*a+0.59*d+0.11*e};a.hardResize=function(l,d,e,b){var c,i;i=a.newToolbox(d,e);c=i[0];i[1].drawImage(l,0,0,d,e);return q(b,c)};a.resize=function(){var a,d,e,b,c,f,g;a=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];b={width:null,height:null};c={width:null,height:null};f=i(d,800,null,null,null,null,null);d=f[0];b.width=f[1];b.height=f[2];c.width=f[3];c.height=f[4];
e=f[5];f={width:null,height:null};"width"===e?g="height":"height"===e?g="width":a.height>a.width?(e="height",g="width"):(e="width",g="height");console.log("hallo");b[e]&&(a[e]>b[e]||a[g]>b[g])?(f[g]=a[g]*b[e]/a[e],f[e]=b[e],f[g]>b[g]&&(f[e]=a[e]*b[g]/a[g],f[g]=b[g])):c[e]&&(a[e]<c[e]||a[g]>c[g])?(f[e]=a[e]*c[g]/a[g],f[g]=c[g],f[e]<c[e]&&(f[g]=a[g]*c[e]/a[e],f[e]=c[e])):(f[e]=a[e],f[g]=a[g]);c=s(f.width,f.height,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));b=c[0];
c[1].drawImage(a,0,0,f.width,f.height);return q(d,b)};a.scale=function(){var a,d,e,b,c,f;a=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c=i(d,1);d=c[0];e=c[1];c=a.width*e;b=a.height*e;f=s(c,b,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));e=f[0];f[1].drawImage(a,0,0,c,b);return q(d,e)};a.crop=function(){var a,d,e,b,c,f,g,h;a=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];e=i(d,0,0,a.width/2,a.height/2);d=e[0];c=e[1];f=e[2];b=e[3];e=e[4];h=
s(b,e,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));g=h[0];h[1].drawImage(a,c,f,b,e,0,0,b,e);return q(d,g)};a.rotateRight=function(a,d){var e;e=s(a)[1];e.rotate(90*Math.PI/180);e.drawImage(a,0,-1*a.height);return q(d,a)};a.rotateLeft=function(a,d){var e;e=s(a)[1];e.rotate(-90*Math.PI/180);e.drawImage(a,-1*a.width,0);return q(d,a)};a.flip=function(a,d){var e;e=s(a)[1];e.rotate(Math.PI);e.drawImage(a,-1*a.width,-1*a.height);return q(d,a)};a.mirror=function(a,d){var e;
e=s(a)[1];e.translate(c2.width/2,0);e.scale(-1,1);e.drawImage(a,-1*(c2.width/2),0);return q(d,a)};a.merge=function(){var b,d,e,f;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];f=i(d,null);d=f[0];for(f=f[1];!f;)return!1;e=a.getToolbox(a.hardResize(f,b.width,b.height))[3];return a.rgba(b,d,function(a,d,b,l,f){a=c(a*e[f]/255);d=c(d*e[f+1]/255);b=c(b*e[f+2]/255);return[a,d,b,l]})};a.hardmerge=function(){var b,d,e,c,g,h;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];e=i(d,null,
"source-over",1);d=e[0];h=e[1];e=e[3];g=a.getToolbox(f(b));c=g[0];g=g[1];b=a.getToolbox(a.hardResize(h,b.width,b.height))[0];g.globalCompositeOperation=e;g.drawImage(b,0,0);return q(d,c)};a.negmerge=function(){var b,d,e,f;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];f=i(d,null);d=f[0];for(f=f[1];!f;)return!1;e=a.getToolbox(a.hardResize(f,b.width,b.height))[3];return a.rgba(b,d,function(a,d,b,l,f){a=c(255*(a/e[f]));d=c(255*(d/e[f+1]));b=c(255*(b/e[f+2]));return[a,d,b,l]})};a.lightmerge=
function(){var b,d,e,c;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c=i(d,null);d=c[0];for(c=c[1];!c;)return!1;e=a.getToolbox(a.hardResize(c,b.width,b.height))[3];return a.rgba(b,d,function(a,d,b,c,l){a=a>e[l]?a:e[l];d=d>e[l+1]?d:e[l+1];b=b>e[l+2]?b:e[l+2];return[a,d,b,c]})};a.darkmerge=function(){var b,d,e,c;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c=i(d,null);d=c[0];for(c=c[1];!c;)return!1;e=a.getToolbox(a.hardResize(c,b.width,b.height))[3];return a.rgba(b,d,function(a,
d,b,c,l){a=a<e[l]?a:e[l];d=d<e[l+1]?d:e[l+1];b=b<e[l+2]?b:e[l+2];return[a,d,b,c]})};a.lightermerge=function(){var b,d,e,c;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c=i(d,null);d=c[0];for(c=c[1];!c;)return!1;e=a.getToolbox(a.hardResize(c,b.width,b.height))[3];return a.rgba(b,d,function(a,d,b,c,l){var f,a=(f=o(a,d,b)>o(e[l],e[l+1],e[l+2])?!0:!1)?a:e[l],d=f?d:e[l+1],b=f?b:e[l+2];return[a,d,b,c]})};a.darkermerge=function(){var b,d,e,c;b=arguments[0];d=2<=arguments.length?r.call(arguments,
1):[];c=i(d,null);d=c[0];for(c=c[1];!c;)return!1;e=a.getToolbox(a.hardResize(c,b.width,b.height))[3];return a.rgba(b,d,function(a,b,d,c,l){var f,a=(f=o(a,b,d)<o(e[l],e[l+1],e[l+2])?!0:!1)?a:e[l],b=f?b:e[l+1],d=f?d:e[l+2];return[a,b,d,c]})};a.blend=function(){var b,d,e,f,g,h,j;d=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];j=i(e,null,0.5);e=j[0];h=j[1];for(b=j[2];!h;)return!1;g=a.getToolbox(a.hardResize(h,d.width,d.height))[3];f=1-b;return a.rgba(d,e,function(a,e,d,i,h){a=c(a*f+g[h]*b);
e=c(e*f+g[h+1]*b);d=c(d*f+g[h+2]*b);return[a,e,d,i]})};a.viewfinder=function(){var c,d,e,f;c=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];e=k(e,"./img/viewfinder.png");d=e[0];e=e[1];b(d,"Franz.viewfinder");f=new Image;f.onload=function(){return a.merge(c,f,d)};f.src=e;return!0};a.oldschool=function(){var c,d,e,f;c=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];e=k(e,"./img/oldschool.png");d=e[0];e=e[1];b(d,"Franz.oldschool");f=new Image;f.onload=function(){return a.lightermerge(c,
f,d)};f.src=e;return!0};a.rgbaAd=function(){var b,d,e,f,g,h,j;e=arguments[0];f=2<=arguments.length?r.call(arguments,1):[];j=i(f,0,0,0,0);f=j[0];h=j[1];g=j[2];d=j[3];b=j[4];return a.rgba(e,f,function(a,e,f,i){return[c(i+h),c(e+g),c(f+d),c(i+b)]})};a.adBrighter=function(){var b,d,e;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];e=i(d,0);d=e[0];e=e[1];return a.rgbaAd(b,e,e,e,0,d)};a.adDarker=function(){var b,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=i(d,0);return a.brighter(b,
-1*d[1],d[0])};a.adOpacity=function(){var b,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=i(d,0);return a.rgbaAd(b,0,0,0,d[1],d[0])};a.rgbaMultiply=function(){var b,d,e,f,g,h;e=arguments[0];f=2<=arguments.length?r.call(arguments,1):[];h=i(f,1,1,1,1);f=h[0];g=h[2];d=h[3];b=h[4];return a.rgba(e,f,function(a,e,f,i){return[c(i*b),c(e*g),c(f*d),c(i*b)]})};a.brighter=function(){var b,d,e;b=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];e=i(e,1);d=e[0];e=e[1];return a.rgbaMultiply(b,
e,e,e,1,d)};a.darker=function(){var b,d,e;b=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];e=i(e,1);d=e[0];e=e[1];e=2-e;return a.rgbaMultiply(b,e,e,e,1,d)};a.opacity=function(){var b,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=i(d,1);return a.rgbaMultiply(b,1,1,1,d[1],d[0])};a.many=function(){var c,d,e,f,g,h,j;e=arguments[0];c=2<=arguments.length?r.call(arguments,1):[];c=i(c);f=c[0];d=c[1];h=c[2];b(f);c=null!=(g=null!=d?d.shift():void 0)?g:null;for(g=null!=(j=null!=
h?h.shift():void 0)?j:[];!Array.isArray(g);)g=[g];return 0<d.length?c.apply(null,[e,function(b){return a.many(b,f,d,h)}].concat(r.call(g))):c(e,f,g)};a.applyIfRgba=function(b,d,e,c,f){var i;i=a.copy(b);i=a.getToolbox(i)[0];return a.many(b,[d],[e],function(b){var e,d;d=a.getToolbox(b);b=d[0];e=d[3];a.newToolbox(b);return a.rgba(i,f,function(a,b,d,f,l){return c(a,b,d,f,l)?[e[l],e[l+1],e[l+2],e[l+3]]:[a,b,d,f,l]})})};a.preserveGreen=function(b,d){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,d){return a>
b||d>b?!0:!1},d)};a.preserveBlue=function(b,d){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,d){return a>d||b>d?!0:!1},d)};a.preserveRed=function(b,d){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,d){return b>a||d>a?!0:!1},d)};a.preserveYellow=function(b,d){return a.applyIfRgba(b,a.blackWhite,[],function(a,b,d){return 127<a&&127<b&&50>d?!1:!0},d)};a.nothing=function(){var b,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=i(d)[0];return a.rgba(b,d,function(a,b,d,c){return[a,
b,d,c]})};a.saturate=function(){var b,d,e,f;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];f=i(d,0.3);d=f[0];e=f[1];return a.rgba(b,d,function(a,b,d,f){var l;l=(a+b+d)/3;return[c(l+e*(a-l)),c(l+e*(b-l)),c(l+e*(d-l)),f]})};a.desaturate=function(){var b,d;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];d=i(d,0.7);return a.saturate(b,1-d[1],d[0])};a.fill=function(){var b,d,e,f,g,h;d=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];h=i(e,0,0,0);e=h[0];g=h[1];f=h[2];b=
h[3];return a.rgba(d,e,function(a,d,e,i){return[c(g),c(f),c(b),i]})};a.posterize=function(){var b,d,e,f;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];f=i(d,5);d=f[0];e=Math.floor(255/f[1]);return a.rgby(b,d,function(a,b,d,f){a=c(Math.floor(a/e)*e);b=c(Math.floor(b/e)*e);d=c(Math.floor(d/e)*e);return[a,b,d,f]})};a.grayScale=function(a,b){return doRgbaFilter(a,b,function(a,b,d,c){a=(a+b+d)/3;return[a,a,a,c]})};a.tint=function(){var b,d,e,f,g,h,j,k,m;b=arguments[0];d=2<=arguments.length?
r.call(arguments,1):[];m=i(d,85,85,85,170,170,170);d=m[0];k=m[1];j=m[2];h=m[3];g=m[4];e=m[5];f=m[6];k===g&&(g+=1);j===f&&(f+=1);h===e&&(e+=1);return a.rgba(b,d,function(a,b,d,l){a=c((a-k)*(255/(g-k)));b=c((b-k)*(255/(f-j)));d=c((d-h)*(255/(e-h)));return[a,b,d,l]})};a.sepia=function(b,d){return a.rgba(b,d,function(a,b,d,f){var l,i;i=0.349*a+0.686*b+0.168*d;l=0.272*a+0.534*b+0.131*d;return[c(0.393*a+0.769*b+0.189*d),c(i),c(l),f]})};a.blackWhite=function(b,d){return a.rgba(b,d,function(a,b,d,c){a=0.3*
a+0.59*b+0.11*d;return[a,a,a,c]})};a.solarize=function(b,d){return a.rgba(b,d,function(a,b,d,c){return[127<a?255-a:a,127<b?255-b:b,127<d?255-d:d,c]})};a.screen=function(){var b,d,e,c,f,g,h;d=arguments[0];e=2<=arguments.length?r.call(arguments,1):[];h=i(e,227,12,169,0.2);e=h[0];f=h[1];c=h[2];b=h[3];g=h[4];return a.rgba(d,e,function(a,d,e,i){return[255-(255-a)*(255-f*g)/255,255-(255-d)*(255-c*g)/255,255-(255-e)*(255-b*g)/255,i]})};a.noise=function(){var a,b,e,h,j,k,m,o,n,p,s;b=arguments[0];e=2<=arguments.length?
r.call(arguments,1):[];a=i(e,20);e=a[0];a=a[1];h=g(f(b));b=h[0];k=h[1];m=h[2];o=h[3];h=p=0;for(s=o.length;p<s;h=++p){n=Math.round(a-Math.random()*a/2);for(j=0;3>j;)o[h+j]=c(n+o[h+j]),j+=1}k.putImageData(m,0,0);return q(e,b)};a.threshold=function(){var b,d,e,c;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c=i(d,128);d=c[0];e=c[1];return a.rgba(b,d,function(a,d,c,f){b=a>e||d>e||c>e?255:0;return[b,b,b,f]})};a.vignette=function(){var a,b,e,c,h,j,k;b=arguments[0];e=2<=arguments.length?r.call(arguments,
1):[];a=i(e,0.2,0.8);e=a[0];k=a[1];a=a[2];c=g(f(b));b=c[0];h=c[1];j=Math.sqrt(Math.pow(b.width/2,2)+Math.pow(b.height/2,2));h.globalCompositeOperation="source-over";c=h.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,j);c.addColorStop(0,"rgba(0,0,0,0)");c.addColorStop(0.65,"rgba(0,0,0,0)");c.addColorStop(1,"rgba(0,0,0,"+a+")");h.fillStyle=c;h.fillRect(0,0,b.width,b.height);h.globalCompositeOperation="lighter";c=h.createRadialGradient(b.width/2,b.height/2,0,b.width/2,b.height/2,j);
c.addColorStop(0,"rgba(255,255,255,"+k+")");c.addColorStop(0.65,"rgba(255,255,255,0)");c.addColorStop(1,"rgba(0,0,0,0)");h.fillStyle=c;h.fillRect(0,0,b.width,b.height);return q(e,b)};a.schemer=function(){var b,d,e,f,g,j,k,m,o,n,p;g=arguments[0];j=2<=arguments.length?r.call(arguments,1):[];h(i(j,1,2,3,4,5,6,7,8,[],[]));k=i(j,[],[],[],[],[],[],[],[]);j=k[0];n=k[1];m=k[2];e=k[3];b=k[4];p=k[5];o=k[6];f=k[7];d=k[8];k=function(a,b){return a-b};n=n.sort(k);h(n);m=m.sort(k);e=e.sort(k);b=b.sort(k);return a.rgba(g,
j,function(a,i,g,h){var j,k,r,q,s,u,t,A,C,M,R,S;j=[a,i,g,h];s=j[0];r=j[1];k=j[2];j=j[3];if(0<n.length){q=t=0;for(R=n.length;t<R;q=++t)if(u=n[q],a<=u){s=null!=(A=p[q])?A:u;break}}if(0<m.length){q=A=0;for(u=m.length;A<u;q=++A)if(a=m[q],i<=a){r=null!=(C=o[q])?C:a;break}}if(0<e.length){q=C=0;for(a=e.length;C<a;q=++C)if(i=e[q],g<=i){k=null!=(M=f[q])?M:i;break}}if(0<b.length){q=M=0;for(i=b.length;M<i;q=++M)if(g=b[q],h<=g){j=null!=(S=d[q])?S:g;break}}return[c(s),c(r),c(k),c(j)]})};a.reduceAndReplace=function(){var b,
d,c,f,g,j;b=arguments[0];d=2<=arguments.length?r.call(arguments,1):[];c={c64:[[0,0,0],[255,255,255],[116,67,53],[124,172,186],[123,72,144],[100,151,79],[64,50,133],[191,205,122],[123,91,47],[79,69,0],[163,114,101],[80,80,80],[120,120,120],[164,215,142],[120,106,189],[159,159,159]]};g=i(d,c.c64);d=g[0];g=g[1];Array.isArray(g)||(g=c[g]);f=g.length;h(g);j=g.sort(function(a,b){return(3*a[0]+4*a[1]+a[2]>>>3)-(3*b[0]+4*b[1]+b[2]>>>3)});h(j);return a.rgba(b,d,function(a,b,d,c){a=j[Math.floor((3*a+4*b+d>>>
3)/256*f)];return[a[0],a[1],a[2],c]})};a.ascii=function(){var a,b;a=2<=arguments.length?r.call(arguments,1):[];return b=i(a,"@GLftli;:,.  "),b};a.removeNoise=function(){var b,d,c,f,h,j,k,m,n,o,p,s,F,z,w,B,O,P,J,K,L,t,Q;j=arguments[0];k=2<=arguments.length?r.call(arguments,1):[];k=i(k)[0];B=g(j);j=B[0];B=B[3];p=[j.width,j.height];j=p[0];p=p[1];K=new Uint8Array(new ArrayBuffer(B.length));for(t=0;t<p;){O=t===p?t:t+1;P=0===t?0:t-1;L=0;for(Q=t*j;L<j;)b=4*(Q+L),d=L===j?L:L+1,h=4*(O*j+d),c=4*(P*j+d),J=b,
m=b+1,d=b+2,b+=3,w=F=B[c],s=B[J-4],z=B[J+4],f=B[h],s<w&&(w=s),z<w&&(w=z),f<w&&(w=f),s>F&&(F=s),z>F&&(F=z),f>F&&(F=f),z=s=B[c+1],f=B[m-4],n=B[m+4],o=B[h+1],f<z&&(z=f),n<z&&(z=n),o<z&&(z=o),f>s&&(s=f),n>s&&(s=n),o>s&&(s=o),o=n=B[c+2],c=B[d-4],f=B[d+4],h=B[h+2],c<o&&(o=c),f<o&&(o=f),h<o&&(o=h),c>n&&(n=c),f>n&&(n=f),h>n&&(n=h),J>F?K[J]=F:J<w&&(K[J]=w),m>s?K[m]=s:m<z&&(K[m]=z),d>n?K[d]=n:d<o&&(K[d]=o),K[b]=B[b],L+=1;t+=1}B=a.byArray(K,j,p);return q(k,B)};a.curve=function(){var b,d,c,f,g,h;d=arguments[0];
c=2<=arguments.length?r.call(arguments,1):[];h=i(c,[0,0,0,1,1,2,3,3,3,4,4,4,5,5,5,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,10,11,11,12,12,12,12,13,13,13,14,14,15,15,16,16,17,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,44,45,47,48,49,52,54,55,57,59,60,62,65,67,69,70,72,74,77,79,81,83,86,88,90,92,94,97,99,101,103,107,109,111,112,116,118,120,124,126,127,129,133,135,136,140,142,143,145,149,150,152,155,157,159,162,163,165,167,170,171,173,176,177,178,180,183,184,185,188,
189,190,192,194,195,196,198,200,201,202,203,204,206,207,208,209,211,212,213,214,215,216,218,219,219,220,221,222,223,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,244,245,245,245,246,247,247,248,248,249,249,249,250,251,251,252,252,252,253,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[0,0,1,2,2,3,5,5,6,7,8,8,10,11,11,12,13,15,15,16,17,18,18,19,
21,22,22,23,24,26,26,27,28,29,31,31,32,33,34,35,35,37,38,39,40,41,43,44,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,83,84,85,86,88,89,90,92,93,94,95,96,97,100,101,102,103,105,106,107,108,109,111,113,114,115,117,118,119,120,122,123,124,126,127,128,129,131,132,133,135,136,137,138,140,141,142,144,145,146,148,149,150,151,153,154,155,157,158,159,160,162,163,164,166,167,168,169,171,172,173,174,175,176,177,178,179,181,182,183,184,186,186,187,188,189,
190,192,193,194,195,195,196,197,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,226,227,228,228,229,230,231,232,232,232,233,234,235,235,236,236,237,238,238,239,239,240,240,241,242,242,242,243,244,245,245,246,246,247,247,248,249,249,249,250,251,251,252,252,252,253,254,255],[53,53,53,54,54,54,55,55,55,56,57,57,57,58,58,58,59,59,59,60,61,61,61,62,62,63,63,63,64,65,65,65,66,66,67,67,67,68,69,69,69,70,70,71,71,72,73,73,
73,74,74,75,75,76,77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,93,93,94,94,95,95,96,97,98,98,99,99,100,101,102,102,103,104,105,105,106,106,107,108,109,109,110,111,111,112,113,114,114,115,116,117,117,118,119,119,121,121,122,122,123,124,125,126,126,127,128,129,129,130,131,132,132,133,134,134,135,136,137,137,138,139,140,140,141,142,142,143,144,145,145,146,146,148,148,149,149,150,151,152,152,153,153,154,155,156,156,157,157,158,159,160,160,161,161,162,162,163,164,164,
165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,177,178,178,179,180,180,181,181,181,182,182,183,184,184,184,185,185,186,186,186,187,188,188,188,189,189,189,190,190,191,191,192,192,193,193,193,194,194,194,195,196,196,196,197,197,197,198,199]);c=h[0];g=h[1];f=h[2];b=h[3];return a.rgba(d,c,function(a,c,d,e){return[g[a],f[c],b[d],e]})};a.binarize=m(ImageFilters.Binarize,0.5);a.boxBlur=m(ImageFilters.BoxBlur,3,3,2);a.gaussianBlur=m(ImageFilters.GaussianBlur,
2);a.stackBlur=m(ImageFilters.StackBlur,6);a.brightness=m(ImageFilters.brightness,1);a.brightnessConstrastGimp=m(ImageFilters.BrightnessContrastGimp,50,50);a.brightnessConstrastPhotoshop=m(ImageFilters.BrightnessContrastPhotoshop,50,50);a.Channels=function(a){return m(ImageFilters.Channels,"blue"===a||"b"===a?3:"green"===a||"g"===a?2:a)};a.colorTransform=m(ImageFilters.ColorTransformFilter,1,1,1,0,0,0);a.dither=m(ImageFilters.Dither,2);a.edge=m(ImageFilters.Edge);a.emboss=m(ImageFilters.Emboss);a.enrich=
m(ImageFilters.Enrich);a.gamma=m(ImageFilters.Gamma,2);a.HSLAdjustment=m(ImageFilters.HSLAdjustment,0,0,0);a.invert=m(ImageFilters.Invert);a.mosaic=m(ImageFilters.Mosaic,10);a.oil=m(ImageFilters.Oil,4,30);a.sharpen=m(ImageFilters.Sharpen,3);a.twirl=m(ImageFilters.Twril,0.5,0.5,100,360)}).call(this);
