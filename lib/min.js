var ImageFilters={utils:{initSampleCanvas:function(){var a=document.createElement("canvas"),b=a.getContext("2d");a.width=0;a.height=0;ImageFilters.getSamplecanvas=function(){return a};this.getSampleContext=function(){return b};this.createImageData=b.createImageData?function(a,f){return b.createImageData(a,f)}:function(a,b){return new ImageData(a,b)}},getSampleCanvas:function(){this.initSampleCanvas();return ImageFilters.getSamplecanvas()},getSampleContext:function(){this.initSampleCanvas();return this.getSampleContext()},
createImageData:function(a,b){this.initSampleCanvas();return this.createImageData(a,b)},clamp:function(a){return 255<a?255:0>a?0:a},buildMap:function(a){for(var b=[],e=0,f;256>e;e+=1)b[e]=255<(f=a(e))?255:0>f?0:f|0;return b},applyMap:function(a,b,e){for(var f=0,j=a.length;f<j;f+=4)b[f]=e[a[f]],b[f+1]=e[a[f+1]],b[f+2]=e[a[f+2]],b[f+3]=a[f+3]},mapRGB:function(a,b,e){this.applyMap(a,b,this.buildMap(e))},getPixelIndex:function(a,b,e,f,j){if(0>a||a>=e||0>b||b>=f)switch(j){case 1:a=0>a?0:a>=e?e-1:a;b=0>
b?0:b>=f?f-1:b;break;case 2:a=0>(a%=e)?a+e:a;b=0>(b%=f)?b+f:b;break;default:return null}return b*e+a<<2},getPixel:function(a,b,e,f,j,g){if(0>b||b>=f||0>e||e>=j)switch(g){case 1:b=0>b?0:b>=f?f-1:b;e=0>e?0:e>=j?j-1:e;break;case 2:b=0>(b%=f)?b+f:b;e=0>(e%=j)?e+j:e;break;default:return 0}b=e*f+b<<2;return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},getPixelByIndex:function(a,b){return a[b+3]<<24|a[b]<<16|a[b+1]<<8|a[b+2]},copyBilinear:function(a,b,e,f,j,g,k,n){var l=0>b?b-1|0:b|0,q=0>e?e-1|0:e|0,b=b-l,e=e-
q,h,m=0,i=0,r=0;h=0;if(0<=l&&l<f-1&&0<=q&&q<j-1)if(h=q*f+l<<2,b||e)m=a[h+3]<<24|a[h]<<16|a[h+1]<<8|a[h+2],h+=4,i=a[h+3]<<24|a[h]<<16|a[h+1]<<8|a[h+2],h=h-8+(f<<2),r=a[h+3]<<24|a[h]<<16|a[h+1]<<8|a[h+2],h+=4,h=a[h+3]<<24|a[h]<<16|a[h+1]<<8|a[h+2];else{g[k]=a[h];g[k+1]=a[h+1];g[k+2]=a[h+2];g[k+3]=a[h+3];return}else if(m=this.getPixel(a,l,q,f,j,n),b||e)i=this.getPixel(a,l+1,q,f,j,n),r=this.getPixel(a,l,q+1,f,j,n),h=this.getPixel(a,l+1,q+1,f,j,n);else{g[k]=m>>16&255;g[k+1]=m>>8&255;g[k+2]=m&255;g[k+3]=
m>>24&255;return}n=1-b;l=1-e;a=((m>>16&255)*n+(i>>16&255)*b)*l+((r>>16&255)*n+(h>>16&255)*b)*e;f=((m>>8&255)*n+(i>>8&255)*b)*l+((r>>8&255)*n+(h>>8&255)*b)*e;j=((m&255)*n+(i&255)*b)*l+((r&255)*n+(h&255)*b)*e;b=((m>>24&255)*n+(i>>24&255)*b)*l+((r>>24&255)*n+(h>>24&255)*b)*e;g[k]=255<a?255:0>a?0:a|0;g[k+1]=255<f?255:0>f?0:f|0;g[k+2]=255<j?255:0>j?0:j|0;g[k+3]=255<b?255:0>b?0:b|0},rgbToHsl:function(a,b,e){var a=a/255,b=b/255,e=e/255,f=a>b?a>e?a:e:b>e?b:e,j=a<b?a<e?a:e:b<e?b:e,g=f-j,k=0,n=0,l=(j+f)/2;
0!==g&&(k=(a===f?(b-e)/g+(b<e?6:0):b===f?(e-a)/g+2:(a-b)/g+4)/6,n=0.5<l?g/(2-f-j):g/(f+j));return[k,n,l]},hslToRgb:function(a,b,e){var f;f=[];if(0===b)f=b=e=255*e+0.5|0,f=[f,b,e];else for(var b=0.5>=e?e*(b+1):e+b-e*b,e=2*e-b,a=a+1/3,j,g=0;3>g;g+=1)0>a?a+=1:1<a&&(a-=1),j=1>6*a?e+6*(b-e)*a:1>2*a?b:2>3*a?e+6*(b-e)*(2/3-a):e,f[g]=255*j+0.5|0,a-=1/3;return f}},Translate:function(){},Scale:function(){},Rotate:function(){},Affine:function(){},UnsharpMask:function(){},ConvolutionFilter:function(a,b,e,f,j,
g,k,n,l,q){var h=a.data,m=a.width,a=a.height,i=ImageFilters.utils.createImageData(m,a),r=i.data,j=j||1,g=g||0;!1!==k&&(k=!0);!1!==n&&(n=!0);for(var l=l||0,o=0,b=b>>1,e=e>>1,s=l>>16&255,c=l>>8&255,l=l&255,q=255*(q||0),d=0;d<a;d+=1)for(var p=0;p<m;p+=1,o+=4){for(var u=0,t=0,C=0,E=0,D=!1,I=0,G,F=-b;F<=b;F+=1){var z=d+F,B;0<=z&&z<a?B=z*m:n?B=d*m:D=!0;for(z=-e;z<=e;z+=1){var A=f[I++];if(0!==A){var v=p+z;0<=v&&v<m||(n?v=p:D=!0);D?(u+=A*s,t+=A*c,C+=A*l,E+=A*q):(v=B+v<<2,u+=A*h[v],t+=A*h[v+1],C+=A*h[v+2],
E+=A*h[v+3])}}}r[o]=255<(G=u/j+g)?255:0>G?0:G|0;r[o+1]=255<(G=t/j+g)?255:0>G?0:G|0;r[o+2]=255<(G=C/j+g)?255:0>G?0:G|0;r[o+3]=k?h[o+3]:255<(G=E/j+g)?255:0>G?0:G|0}return i},Binarize:function(a,b){var e=a.data,f=e.length,j=ImageFilters.utils.createImageData(a.width,a.height),g=j.data;isNaN(b)&&(b=0.5);for(var b=255*b,k=0;k<f;k+=4)g[k]=g[k+1]=g[k+2]=e[k]+e[k+1]+e[k+2]/3<=b?0:255,g[k+3]=255;return j},BlendAdd:function(a,b){for(var e=a.data,f=e.length,j=ImageFilters.utils.createImageData(a.width,a.height),
g=j.data,k=b.data,n,l=0;l<f;l+=4)g[l]=255<(n=e[l]+k[l])?255:n,g[l+1]=255<(n=e[l+1]+k[l+1])?255:n,g[l+2]=255<(n=e[l+2]+k[l+2])?255:n,g[l+3]=255;return j},BlendSubtract:function(a,b){for(var e=a.data,f=e.length,j=ImageFilters.utils.createImageData(a.width,a.height),g=j.data,k=b.data,n,l=0;l<f;l+=4)g[l]=0>(n=e[l]-k[l])?0:n,g[l+1]=0>(n=e[l+1]-k[l+1])?0:n,g[l+2]=0>(n=e[l+2]-k[l+2])?0:n,g[l+3]=255;return j}};
ImageFilters.BoxBlur=function(){var a=function(a,e,f,j,g){var k=2*g+1,n=g+1,l=f-1,q,h,m,i=0,r,o,s,c,d,p=[];c=0;for(q=256*k;c<q;c+=1)p[c]=c/k|0;for(d=0;d<j;d+=1){k=q=h=m=0;r=d;o=i<<2;k+=n*a[o];q+=n*a[o+1];h+=n*a[o+2];m+=n*a[o+3];for(c=1;c<=g;c+=1)o=i+(c<f?c:l)<<2,k+=a[o],q+=a[o+1],h+=a[o+2],m+=a[o+3];for(c=0;c<f;c+=1)o=r<<2,e[o]=p[k],e[o+1]=p[q],e[o+2]=p[h],e[o+3]=p[m],o=c+n,o>l&&(o=l),s=c-g,0>s&&(s=0),o=i+o<<2,s=i+s<<2,k+=a[o]-a[s],q+=a[o+1]-a[s+1],h+=a[o+2]-a[s+2],m+=a[o+3]-a[s+3],r+=j;i+=f}};return function(b,
e,f,j){for(var g=b.data,k=b.width,b=b.height,n=ImageFilters.utils.createImageData(k,b),l=n.data,q=ImageFilters.utils.createImageData(k,b).data,h=0;h<j;h+=1)a(h?l:g,q,k,b,e),a(q,l,b,k,f);return n}}();
ImageFilters.GaussianBlur=function(a,b){var e,f,j;switch(b){case 2:e=5;f=[1,1,2,1,1,1,2,4,2,1,2,4,8,4,2,1,2,4,2,1,1,1,2,1,1];j=52;break;case 3:e=7;f=[1,1,2,2,2,1,1,1,2,2,4,2,2,1,2,2,4,8,4,2,2,2,4,8,16,8,4,2,2,2,4,8,4,2,2,1,2,2,4,2,2,1,1,1,2,2,2,1,1];j=140;break;case 4:e=15;f=[2,2,3,4,5,5,6,6,6,5,5,4,3,2,2,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,6,8,10,13,15,
17,19,19,19,17,15,13,10,8,6,6,8,11,13,16,18,19,20,19,18,16,13,11,8,6,6,8,10,13,15,17,19,19,19,17,15,13,10,8,6,5,7,10,12,14,16,17,18,17,16,14,12,10,7,5,5,7,9,11,13,14,15,16,15,14,13,11,9,7,5,4,5,7,9,10,12,13,13,13,12,10,9,7,5,4,3,4,6,7,9,10,10,11,10,10,9,7,6,4,3,2,3,4,5,7,7,8,8,8,7,7,5,4,3,2,2,2,3,4,5,5,6,6,6,5,5,4,3,2,2];j=2044;break;default:e=3,f=[1,2,1,2,4,2,1,2,1],j=16}return ImageFilters.ConvolutionFilter(a,e,e,f,j,0,!1)};
ImageFilters.StackBlur=function(){function a(){this.a=this.b=this.g=this.r=0;this.next=null}var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,
404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,
323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],e=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,
23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];return function(f,j){var g=f.width,k=f.height,n=ImageFilters.Clone(f),l=n.data,q,h,m,i,r,o,s,c,d,p,u,t,C,E,D,I,G,F,z,B,A,v,
J;q=j+j+1;var Q=g-1,N=k-1,H=j+1,K=H*(H+1)/2,L=new a,w=L,P,M=b[j],O=e[j];for(m=1;m<q;m+=1)w=w.next=new a,m==H&&(P=w);w.next=L;for(h=o=r=0;h<k;h+=1){D=I=G=F=s=c=d=p=0;u=H*(z=l[r]);t=H*(B=l[r+1]);C=H*(A=l[r+2]);E=H*(v=l[r+3]);s+=K*z;c+=K*B;d+=K*A;p+=K*v;w=L;for(m=0;m<H;m+=1)w.r=z,w.g=B,w.b=A,w.a=v,w=w.next;for(m=1;m<H;m+=1)i=r+((Q<m?Q:m)<<2),s+=(w.r=z=l[i])*(J=H-m),c+=(w.g=B=l[i+1])*J,d+=(w.b=A=l[i+2])*J,p+=(w.a=v=l[i+3])*J,D+=z,I+=B,G+=A,F+=v,w=w.next;m=L;w=P;for(q=0;q<g;q+=1)l[r]=s*M>>O,l[r+1]=c*M>>
O,l[r+2]=d*M>>O,l[r+3]=p*M>>O,s-=u,c-=t,d-=C,p-=E,u-=m.r,t-=m.g,C-=m.b,E-=m.a,i=o+((i=q+j+1)<Q?i:Q)<<2,D+=m.r=l[i],I+=m.g=l[i+1],G+=m.b=l[i+2],F+=m.a=l[i+3],s+=D,c+=I,d+=G,p+=F,m=m.next,u+=z=w.r,t+=B=w.g,C+=A=w.b,E+=v=w.a,D-=z,I-=B,G-=A,F-=v,w=w.next,r+=4;o+=g}for(q=0;q<g;q+=1){I=G=F=D=c=d=p=s=0;r=q<<2;u=H*(z=l[r]);t=H*(B=l[r+1]);C=H*(A=l[r+2]);E=H*(v=l[r+3]);s+=K*z;c+=K*B;d+=K*A;p+=K*v;w=L;for(m=0;m<H;m+=1)w.r=z,w.g=B,w.b=A,w.a=v,w=w.next;i=g;for(m=1;m<=j;m+=1)r=i+q<<2,s+=(w.r=z=l[r])*(J=H-m),c+=
(w.g=B=l[r+1])*J,d+=(w.b=A=l[r+2])*J,p+=(w.a=v=l[r+3])*J,D+=z,I+=B,G+=A,F+=v,w=w.next,m<N&&(i+=g);r=q;m=L;w=P;for(h=0;h<k;h+=1)i=r<<2,l[i]=s*M>>O,l[i+1]=c*M>>O,l[i+2]=d*M>>O,l[i+3]=p*M>>O,s-=u,c-=t,d-=C,p-=E,u-=m.r,t-=m.g,C-=m.b,E-=m.a,i=q+((i=h+H)<N?i:N)*g<<2,s+=D+=m.r=l[i],c+=I+=m.g=l[i+1],d+=G+=m.b=l[i+2],p+=F+=m.a=l[i+3],m=m.next,u+=z=w.r,t+=B=w.g,C+=A=w.b,E+=v=w.a,D-=z,I-=B,G-=A,F-=v,w=w.next,r+=g}return n}}();
ImageFilters.Brightness=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a+=b;return 255<a?255:a});return f};
ImageFilters.BrightnessContrastGimp=function(a,b,e){for(var f=a.data,j=f.length,a=ImageFilters.utils.createImageData(a.width,a.height),g=a.data,k=Math.PI/4,b=b/100,e=0.99*e,e=e/100,e=Math.tan((e+1)*k),n=0,k=0;k<j;k+=4)n+=19595*f[k]+38470*f[k+1]+7471*f[k+2]>>16;n/=j/4;ImageFilters.utils.mapRGB(f,g,function(a){0>b?a*=1+b:0<b&&(a+=(255-a)*b);0!==e&&(a=(a-n)*e+n);return a+0.5|0});return a};
ImageFilters.BrightnessContrastPhotoshop=function(a,b,e){var f=a.data,a=ImageFilters.utils.createImageData(a.width,a.height),j=a.data,b=(b+100)/100,e=(e+100)/100;ImageFilters.utils.mapRGB(f,j,function(a){a*=b;a=(a-127.5)*e+127.5;return a+0.5|0});return a};
ImageFilters.Channels=function(a,b){var e;switch(b){case 2:e=[0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0];break;case 3:e=[0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0];break;default:e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,1,0]}return this.ColorMatrixFilter(a,e)};ImageFilters.Clone=function(a){return this.Copy(a,ImageFilters.utils.createImageData(a.width,a.height))};
ImageFilters.CloneBuiltin=function(a){var b=a.width,e=a.height,f=ImageFilters.utils.getSampleCanvas(),j=ImageFilters.utils.getSampleContext();f.width=b;f.height=e;j.putImageData(a,0,0);a=j.getImageData(0,0,b,e);f.width=0;f.height=0;return a};
ImageFilters.ColorMatrixFilter=function(a,b){var e=a.data,f=e.length,j=ImageFilters.utils.createImageData(a.width,a.height),g=j.data,k=b[0],n=b[1],l=b[2],q=b[3],h=b[4],m=b[5],i=b[6],r=b[7],o=b[8],s=b[9],c=b[10],d=b[11],p=b[12],u=b[13],t=b[14],C=b[15],E=b[16],D=b[17],I=b[18],G=b[19],F,z,B,A,v,J;for(z=0;z<f;z+=4)B=e[z],A=e[z+1],v=e[z+2],J=e[z+3],g[z]=255<(F=B*k+A*n+v*l+J*q+h)?255:0>F?0:F|0,g[z+1]=255<(F=B*m+A*i+v*r+J*o+s)?255:0>F?0:F|0,g[z+2]=255<(F=B*c+A*d+v*p+J*u+t)?255:0>F?0:F|0,g[z+3]=255<(F=B*
C+A*E+v*D+J*I+G)?255:0>F?0:F|0;return j};ImageFilters.ColorTransformFilter=function(a,b,e,f,j,g,k,n,l){var q=a.data,h=q.length,a=ImageFilters.utils.createImageData(a.width,a.height),m=a.data,i,r;for(i=0;i<h;i+=4)m[i]=255<(r=q[i]*b+g)?255:0>r?0:r,m[i+1]=255<(r=q[i+1]*e+k)?255:0>r?0:r,m[i+2]=255<(r=q[i+2]*f+n)?255:0>r?0:r,m[i+3]=255<(r=q[i+3]*j+l)?255:0>r?0:r;return a};ImageFilters.Copy=function(a,b){for(var e=a.data,f=e.length,j=b.data;f--;)j[f]=e[f];return b};
ImageFilters.Crop=function(a,b,e,f,j){var g=a.data,k=a.width,n=a.height,a=ImageFilters.utils.createImageData(f,j),l=a.data,q=Math.max(b,0),h=Math.max(e,0),m=Math.min(b+f,k),j=Math.min(e+j,n),b=q-b,i,n=h;for(dstRow=h-e;n<j;n+=1,dstRow+=1){e=q;for(dstCol=b;e<m;e+=1,dstCol+=1)h=n*k+e<<2,i=dstRow*f+dstCol<<2,l[i]=g[h],l[i+1]=g[h+1],l[i+2]=g[h+2],l[i+3]=g[h+3]}return a};
ImageFilters.CropBuiltin=function(a,b,e,f,j){var g=a.width,k=a.height,n=ImageFilters.utils.getSampleCanvas(),l=ImageFilters.utils.getSampleContext();n.width=g;n.height=k;l.putImageData(a,0,0);a=l.getImageData(b,e,f,j);n.width=0;n.height=0;return a};
ImageFilters.Desaturate=function(a){for(var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,j=0;j<e;j+=4){var g=b[j],k=b[j+1],n=b[j+2];f[j]=f[j+1]=f[j+2]=((g>k?g>n?g:n:k>n?k:n)+(g<k?g<n?g:n:k<n?k:n))/2+0.5|0;f[j+3]=b[j+3]}return a};
ImageFilters.DisplacementMapFilter=function(a,b,e,f,j,g,k,n,l){var q=a.data,h=a.width,m=a.height,a=ImageFilters.Clone(a),i=a.data;e||(e=0);f||(f=0);j||(j=0);g||(g=0);k||(k=0);n||(n=0);l||(l=2);var r=b.width,o=b.data,s=r+e,b=b.height+f,c,d,p,u,t;for(u=0;u<h;u+=1)for(t=0;t<m;t+=1)c=t*h+u<<2,u<e||t<f||u>=s||t>=b?d=c:(p=(t-f)*r+(u-e)<<2,d=o[p+j],d=u+((d-128)*k>>8),p=o[p+g],p=t+((p-128)*n>>8),d=ImageFilters.utils.getPixelIndex(d+0.5|0,p+0.5|0,h,m,l),null===d&&(d=c)),i[c]=q[d],i[c+1]=q[d+1],i[c+2]=q[d+
2],i[c+3]=q[d+3];return a};
ImageFilters.Dither=function(a,b){var e=a.width,f=a.height,j=ImageFilters.Clone(a),g=j.data,b=2>b?2:255<b?255:b,k,n=[];k=b-1;var l=0,q=0,h;for(h=0;h<b;h+=1)n[h]=255*h/k;k=ImageFilters.utils.buildMap(function(){var a=n[l];q+=b;255<q&&(q-=255,l+=1);return a});var m,i,r,o,s,c,d,p,u=e-1,t=f-1;for(m=0;m<f;m+=1)for(h=0;h<e;h+=1)if(i=m*e+h<<2,r=g[i],o=g[i+1],s=g[i+2],c=k[r],d=k[o],p=k[s],g[i]=c,g[i+1]=d,g[i+2]=p,r-=c,o-=d,s-=p,i+=4,h<u&&(p=g[i]+0.4375*r,d=g[i+1]+0.4375*o,c=g[i+2]+0.4375*s,g[i]=255<p?255:
0>p?0:p|0,g[i+1]=255<d?255:0>d?0:d|0,g[i+2]=255<c?255:0>c?0:c|0),i+=e-2<<2,0<h&&m<t&&(p=g[i]+0.1875*r,d=g[i+1]+0.1875*o,c=g[i+2]+0.1875*s,g[i]=255<p?255:0>p?0:p|0,g[i+1]=255<d?255:0>d?0:d|0,g[i+2]=255<c?255:0>c?0:c|0),i+=4,m<t&&(p=g[i]+0.3125*r,d=g[i+1]+0.3125*o,c=g[i+2]+0.3125*s,g[i]=255<p?255:0>p?0:p|0,g[i+1]=255<d?255:0>d?0:d|0,g[i+2]=255<c?255:0>c?0:c|0),i+=4,h<u&&m<t)p=g[i]+0.0625*r,d=g[i+1]+0.0625*o,c=g[i+2]+0.0625*s,g[i]=255<p?255:0>p?0:p|0,g[i+1]=255<d?255:0>d?0:d|0,g[i+2]=255<c?255:0>c?0:
c|0;return j};ImageFilters.Edge=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-1,-1,-1,-1,8,-1,-1,-1,-1])};ImageFilters.Emboss=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[-2,-1,0,-1,1,1,0,1,2])};ImageFilters.Enrich=function(a){return ImageFilters.ConvolutionFilter(a,3,3,[0,-2,0,-2,20,-2,0,-2,0],10,-40)};
ImageFilters.Flip=function(a,b){var e=a.data,f=a.width,j=a.height,g=ImageFilters.utils.createImageData(f,j),k=g.data,n,l,q,h;for(l=0;l<j;l+=1)for(n=0;n<f;n+=1)q=l*f+n<<2,h=b?(j-l-1)*f+n<<2:l*f+(f-n-1)<<2,k[h]=e[q],k[h+1]=e[q+1],k[h+2]=e[q+2],k[h+3]=e[q+3];return g};ImageFilters.Gamma=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a=255*Math.pow(a/255,1/b)+0.5;return 255<a?255:a+0.5|0});return f};
ImageFilters.GrayScale=function(a){for(var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,j=0;j<e;j+=4)f[j]=f[j+1]=f[j+2]=19595*b[j]+38470*b[j+1]+7471*b[j+2]>>16,f[j+3]=b[j+3];return a};
ImageFilters.HSLAdjustment=function(a,b,e,f){var j=a.data,g=j.length,a=ImageFilters.utils.createImageData(a.width,a.height),k=a.data,b=b/360,e=e/100,f=f/100,n=ImageFilters.utils.rgbToHsl,l=ImageFilters.utils.hslToRgb,q,h,m,i;for(i=0;i<g;i+=4){m=n(j[i],j[i+1],j[i+2]);for(q=m[0]+b;0>q;)q+=1;for(;1<q;)q-=1;h=m[1]+m[1]*e;0>h?h=0:1<h&&(h=1);m=m[2];0<f?m+=(1-m)*f:0>f&&(m+=m*f);q=l(q,h,m);k[i]=q[0];k[i+1]=q[1];k[i+2]=q[2];k[i+3]=j[i+3]}return a};
ImageFilters.Invert=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 255-a});return a};
ImageFilters.Mosaic=function(a,b){var e=a.data,f=a.width,j=a.height,g=ImageFilters.utils.createImageData(f,j),k=g.data,n=Math.ceil(f/b),l=Math.ceil(j/b),q,h,m,i,r,o,s,c,d,p,u,t,C,E,D;for(q=0;q<l;q+=1){r=q*b;o=r+b;o>j&&(o=j);for(h=0;h<n;h+=1){m=h*b;i=m+b;i>f&&(i=f);t=C=E=D=0;u=(i-m)*(o-r);for(c=r;c<o;c+=1){d=c*f;for(s=m;s<i;s+=1)p=d+s<<2,t+=e[p],C+=e[p+1],E+=e[p+2],D+=e[p+3]}t=t/u+0.5|0;C=C/u+0.5|0;E=E/u+0.5|0;D=D/u+0.5|0;for(c=r;c<o;c+=1){d=c*f;for(s=m;s<i;s+=1)p=d+s<<2,k[p]=t,k[p+1]=C,k[p+2]=E,k[p+
3]=D}}}return g};
ImageFilters.Oil=function(a,b,e){var f=a.data,j=a.width,a=a.height,g=ImageFilters.utils.createImageData(j,a),k=g.data,n=0,l=[],q=[],h=[],m=[],i=[],r=[],o,s,c,d,p,u,t,C,E,D,I;for(s=0;s<a;s+=1)for(o=0;o<j;o+=1){for(c=0;c<e;c+=1)l[c]=q[c]=h[c]=m[c]=i[c]=r[c]=0;for(c=-b;c<=b;c+=1)if(d=s+c,!(0>d||d>=a)){u=d*j;for(d=-b;d<=b;d+=1)p=o+d,0>p||p>=j||(t=u+p<<2,p=f[t],C=f[t+1],t=f[t+2],E=p*e>>8,D=C*e>>8,I=t*e>>8,m[E]+=p,i[D]+=C,r[I]+=t,l[E]+=1,q[D]+=1,h[I]+=1)}d=u=p=0;for(c=1;c<e;c+=1)l[c]>l[d]&&(d=c),q[c]>q[u]&&
(u=c),h[c]>h[p]&&(p=c);k[n]=m[d]/l[d]|0;k[n+1]=i[u]/q[u]|0;k[n+2]=r[p]/h[p]|0;k[n+3]=f[n+3];n+=4}return g};ImageFilters.OpacityFilter=function(a,b){for(var e=a.data,f=e.length,j=ImageFilters.utils.createImageData(a.width,a.height),g=j.data,k=0;k<f;k+=4)g[k]=e[k],g[k+1]=e[k+1],g[k+2]=e[k+2],g[k+3]=b;return j};
ImageFilters.Posterize=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height),j=f.data,b=2>b?2:255<b?255:b,g=[],k=b-1,n=0,l=0,q;for(q=0;q<b;q+=1)g[q]=255*q/k;ImageFilters.utils.mapRGB(e,j,function(){var a=g[n];l+=b;255<l&&(l-=255,n+=1);return a});return f};ImageFilters.Rescale=function(a,b){var e=a.data,f=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(e,f.data,function(a){a*=b;return 255<a?255:a+0.5|0});return f};
ImageFilters.ResizeNearestNeighbor=function(a,b,e){var f=a.data,j=a.width,g=a.height,a=ImageFilters.utils.createImageData(b,e),k=a.data,n=j/b,g=g/e,l=0,q,h,m,i;for(m=0;m<e;m+=1){i=(m*g|0)*j;for(h=0;h<b;h+=1)q=i+h*n<<2,k[l]=f[q],k[l+1]=f[q+1],k[l+2]=f[q+2],k[l+3]=f[q+3],l+=4}return a};
ImageFilters.Resize=function(a,b,e){var f=a.data,j=a.width,a=a.height,g=ImageFilters.utils.createImageData(b,e),k=g.data,n=j/b,l=a/e,q=0,h,m;for(m=0;m<e;m+=1)for(h=0;h<b;h+=1)ImageFilters.utils.copyBilinear(f,h*n,m*l,j,a,k,q,0),q+=4;return g};
ImageFilters.ResizeBuiltin=function(a,b,e){var f=a.width,j=a.height,g=ImageFilters.utils.getSampleCanvas(),k=ImageFilters.utils.getSampleContext();g.width=Math.max(f,b);g.height=Math.max(j,e);k.save();k.putImageData(a,0,0);k.scale(b/f,e/j);k.drawImage(g,0,0);a=k.getImageData(0,0,b,e);k.restore();g.width=0;g.height=0;return a};
ImageFilters.Sepia=function(a){var b=a.data,e=b.length,a=ImageFilters.utils.createImageData(a.width,a.height),f=a.data,j,g,k,n,l;for(n=0;n<e;n+=4)j=b[n],g=b[n+1],k=b[n+2],f[n]=255<(l=0.393*j+0.769*g+0.189*k)?255:0>l?0:l+0.5|0,f[n+1]=255<(l=0.349*j+0.686*g+0.168*k)?255:0>l?0:l+0.5|0,f[n+2]=255<(l=0.272*j+0.534*g+0.131*k)?255:0>l?0:l+0.5|0,f[n+3]=b[n+3];return a};ImageFilters.Sharpen=function(a,b){return ImageFilters.ConvolutionFilter(a,3,3,[-b/16,-b/8,-b/16,-b/8,0.75*b+1,-b/8,-b/16,-b/8,-b/16])};
ImageFilters.Solarize=function(a){var b=a.data,a=ImageFilters.utils.createImageData(a.width,a.height);ImageFilters.utils.mapRGB(b,a.data,function(a){return 127<a?2*(a-127.5):2*(127.5-a)});return a};ImageFilters.Transpose=function(a){var b=a.data,e=a.width,a=a.height,f=ImageFilters.utils.createImageData(a,e),j=f.data,g,k;for(y=0;y<a;y+=1)for(x=0;x<e;x+=1)g=y*e+x<<2,k=x*a+y<<2,j[k]=b[g],j[k+1]=b[g+1],j[k+2]=b[g+2],j[k+3]=b[g+3];return f};
ImageFilters.Twril=function(a,b,e,f,j,g,k){var n=a.data,l=a.width,a=a.height,q=ImageFilters.utils.createImageData(l,a),h=q.data,b=l*b,e=a*e,j=j*(Math.PI/180),m=f*f,i=0,r,o,s,c,d;for(o=0;o<a;o+=1)for(r=0;r<l;r+=1)s=r-b,c=o-e,d=s*s+c*c,d>m?(h[i]=n[i],h[i+1]=n[i+1],h[i+2]=n[i+2],h[i+3]=n[i+3]):(d=Math.sqrt(d),c=Math.atan2(c,s)+j*(f-d)/f,s=b+d*Math.cos(c),d=e+d*Math.sin(c),k?ImageFilters.utils.copyBilinear(n,s,d,l,a,h,i,g):(d=(d+0.5|0)*l+(s+0.5|0)<<2,h[i]=n[d],h[i+1]=n[d+1],h[i+2]=n[d+2],h[i+3]=n[d+3])),
i+=4;return q};(function(){var a,b,e,f,j,g,k,n,l,q,h,m,i,r,o=[].slice;a={_DEBUG_:!0};j=function(a){return console.log(a)};b=function(a,c){for(;!a;)throw Error("Callback required for "+c);return[]};q=function(a){return a&&"[object Function]"===(void 0).call(a)};i=function(){var a,c;a=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];a&&q(a)&&window.setTimeout.apply(window,[a,0].concat(o.call(c)));return null!=c?c[0]:void 0};g=function(){var a,c,d,p,b,e,g,f,i;e=arguments[0];c=2<=arguments.length?o.call(arguments,
1):[];d=null;b=[];p=0;g=function(a){return q(a)&&!d?d=a:b.push(a)};f=0;for(i=e.length;f<i;f++)a=e[f],g(a);e=function(a){var d;return null!=(d=b[p])?d:b[p]=a};p=g=0;for(f=c.length;g<f;p=++g)a=c[p],e(a);d||(d=function(){return null});b.unshift(d);return b};e=function(a,c,d){null==c&&(c=0);null==d&&(d=255);return Math.min(d,Math.max(c,a))};a.getToolbox=n=function(a,c){var d,p;return i(c,[a,d=a.getContext("2d"),p=d.getImageData(0,0,a.width,a.height),p.data])};a.make=m=function(){var a,c,d,p,b;c=1<=arguments.length?
o.call(arguments,0):[];a=g(c,800,600);c=a[0];b=a[1];d=a[2];p=a[3];b.width&&b.height&&(a=b,b=a.width,d=a.height,p=(null!=a?"function"===typeof a.getAttribute?a.getAttribute("id"):void 0:void 0)||(null!=a?"function"===typeof a.getAttribute?a.getAttribute("origin"):void 0:void 0));a=document.createElement("canvas");a.width=b;a.height=d;p&&a.setAttribute("origin",p);return i(c,a)};a.newToolbox=r=function(){var s,c;s=1<=arguments.length?o.call(arguments,0):[];c=g(s);s=c[0];return a.getToolbox(m(c[1],c[2],
c[3]),s)};a.copy=f=function(a,c){var d,p;p=r(a);d=p[0];p[1].drawImage(a,0,0,a.width,a.height);return i(c,d)};a.byImage=function(s,c){if(s.width&&s.height)return f(s,c);b(c,'Franz.byImage (only if the image is not "loaded")');q(c)&&(s.onload=function(){return a.byImage(s,c)});return!0};a.byArray=function(a,c,d,p){var b,e,g;b=r(c,d);c=b[0];d=b[1];e=b[2];g=b[3];for(b=0;b<g.length;)g[b]=a[b],b+=1;d.putImageData(e,0,0);return i(p,c)};a.toImage=function(){var a,c,d,b;a=arguments[0];c=2<=arguments.length?
o.call(arguments,1):[];d=g(c,"image/png");c=d[0];b=d[1];d=new Image;d.src=a.toDataURL(b,"");return i(c,d)};a.toArray=function(a){var c,d;c=[];d=n(a)[3];Uint8Array&&(c=new Uint8Array(new ArrayBuffer(d.length)));for(a=0;a<d.length;)c[a]=d[a],a+=1;return c};a.hardResize=function(s,c,d,b){var e,g;g=a.newToolbox(c,d);e=g[0];g[1].drawImage(s,0,0,c,d);return i(b,e)};a.resize=function(){var a,c,d,b,e,t,f;a=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];b={width:null,height:null};e={width:null,
height:null};t=g(c,800,null,null,null,null,null);c=t[0];b.width=t[1];b.height=t[2];e.width=t[3];e.height=t[4];d=t[5];t={width:null,height:null};"width"===d?f="height":"height"===d?f="width":a.height>a.width?(d="height",f="width"):(d="width",f="height");console.log("hallo");b[d]&&(a[d]>b[d]||a[f]>b[f])?(t[f]=a[f]*b[d]/a[d],t[d]=b[d],t[f]>b[f]&&(t[d]=a[d]*b[f]/a[f],t[f]=b[f])):e[d]&&(a[d]<e[d]||a[f]>e[f])?(t[d]=a[d]*e[f]/a[f],t[f]=e[f],t[d]<e[d]&&(t[f]=a[f]*e[d]/a[d],t[d]=e[d])):(t[d]=a[d],t[f]=a[f]);
e=r(t.width,t.height,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));b=e[0];e[1].drawImage(a,0,0,t.width,t.height);return i(c,b)};a.scale=function(){var a,c,d,b,e,f;a=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];e=g(c,1);c=e[0];d=e[1];e=a.width*d;b=a.height*d;f=r(e,b,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));d=f[0];f[1].drawImage(a,0,0,e,b);return i(c,d)};a.crop=function(){var a,c,d,b,e,f,j,l;a=arguments[0];c=2<=
arguments.length?o.call(arguments,1):[];d=g(c,0,0,a.width/2,a.height/2);c=d[0];e=d[1];f=d[2];b=d[3];d=d[4];l=r(b,d,(null!=a?a.getAttribute("id"):void 0)||(null!=a?a.getAttribute("origin"):void 0));j=l[0];l[1].drawImage(a,e,f,b,d,0,0,b,d);return i(c,j)};a.rgba=function(){var b,c,d,e,f,t,j,l,h,k,m,r,z,B,A,v;d=arguments[0];e=2<=arguments.length?o.call(arguments,1):[];f=g(e,null,!1);e=f[0];t=f[1];f=f[2];if(!q(t))return!1;k=n(d);d=k[0];k=k[3];b=[d.width,d.height];z=b[0];l=b[1];r=new Uint8Array(new ArrayBuffer(k.length));
for(A=0;A<l;){B=0;for(v=A*z;B<z;)m=h=4*(v+B),j=h+1,c=h+2,b=h+3,h=f?t(k[m],k[j],k[c],k[b],h,d):t(k[m],k[j],k[c],k[b],h),r[m]=h[0],r[j]=h[1],r[c]=h[2],r[b]=h[3],B+=1;A+=1}d=a.byArray(r,z,l);return i(e,d)};a.rotateRight=function(a,c){var d;d=r(a)[1];d.rotate(90*Math.PI/180);d.drawImage(a,0,-1*a.height);return i(c,a)};a.rotateLeft=function(a,c){var d;d=r(a)[1];d.rotate(-90*Math.PI/180);d.drawImage(a,-1*a.width,0);return i(c,a)};a.flip=function(a,c){var d;d=r(a)[1];d.rotate(Math.PI);d.drawImage(a,-1*a.width,
-1*a.height);return i(c,a)};a.mirror=function(a,c){var d;d=r(a)[1];d.translate(c2.width/2,0);d.scale(-1,1);d.drawImage(a,-1*(c2.width/2),0);return i(c,a)};a.noise=function(){var a,c,d,b,u,t,j,h,k,l,m;c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];a=g(d,20);d=a[0];a=a[1];b=n(f(c));c=b[0];t=b[1];j=b[2];h=b[3];b=l=0;for(m=h.length;l<m;b=++l){k=Math.round(a-Math.random()*a/2);for(u=0;3>u;)h[b+u]=e(k+h[b+u]),u+=1}t.putImageData(j,0,0);return i(d,c)};a.vignette=function(){var a,c,d,b,e,t,h;
c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];a=g(d,0.2,0.8);d=a[0];h=a[1];a=a[2];b=n(f(c));c=b[0];e=b[1];t=Math.sqrt(Math.pow(c.width/2,2)+Math.pow(c.height/2,2));e.globalCompositeOperation="source-over";b=e.createRadialGradient(c.width/2,c.height/2,0,c.width/2,c.height/2,t);b.addColorStop(0,"rgba(0,0,0,0)");b.addColorStop(0.65,"rgba(0,0,0,0)");b.addColorStop(1,"rgba(0,0,0,"+a+")");e.fillStyle=b;e.fillRect(0,0,c.width,c.height);e.globalCompositeOperation="lighter";b=e.createRadialGradient(c.width/
2,c.height/2,0,c.width/2,c.height/2,t);b.addColorStop(0,"rgba(255,255,255,"+h+")");b.addColorStop(0.65,"rgba(255,255,255,0)");b.addColorStop(1,"rgba(0,0,0,0)");e.fillStyle=b;e.fillRect(0,0,c.width,c.height);return i(d,c)};a.saturate=function(){var b,c,d,p;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];p=g(c,0.3);c=p[0];d=p[1];return a.rgba(b,c,function(a,c,b,p){var s;s=(a+c+b)/3;return[e(s+d*(a-s)),e(s+d*(c-s)),e(s+d*(b-s)),p]})};a.desaturate=function(){var b,c;b=arguments[0];c=2<=arguments.length?
o.call(arguments,1):[];c=g(c,0.7);return a.saturate(b,1-c[1],c[0])};a.merge=function(){var b,c,d,p;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];p=g(c,null);c=p[0];for(p=p[1];!p;)return!1;d=a.getToolbox(a.hardResize(p,b.width,b.height))[3];return a.rgba(b,c,function(a,c,b,p,s){a=e(a*d[s]/255);c=e(c*d[s+1]/255);b=e(b*d[s+2]/255);return[a,c,b,p]})};a.hardmerge=function(){var b,c,d,e,h,t;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];d=g(c,null,"source-over",1);c=d[0];t=d[1];
d=d[3];h=a.getToolbox(f(b));e=h[0];h=h[1];b=a.getToolbox(a.hardResize(t,b.width,b.height))[0];h.globalCompositeOperation=d;h.drawImage(b,0,0);return i(c,e)};a.negmerge=function(){var b,c,d,p;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];p=g(c,null);c=p[0];for(p=p[1];!p;)return!1;d=a.getToolbox(a.hardResize(p,b.width,b.height))[3];return a.rgba(b,c,function(a,b,c,p,f){a=e(255*(a/d[f]));b=e(255*(b/d[f+1]));c=e(255*(c/d[f+2]));return[a,b,c,p]})};a.lightmerge=function(){var b,c,d,e;b=arguments[0];
c=2<=arguments.length?o.call(arguments,1):[];e=g(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,b,c,e,f){a=a>d[f]?a:d[f];b=b>d[f+1]?b:d[f+1];c=c>d[f+2]?c:d[f+2];return[a,b,c,e]})};a.darkmerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];e=g(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,b,c,e,f){a=a<d[f]?a:d[f];b=b<
d[f+1]?b:d[f+1];c=c<d[f+2]?c:d[f+2];return[a,b,c,e]})};k=function(a,b,d){return 0.3*a+0.59*b+0.11*d};a.lightermerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];e=g(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,b,c,e,f){var p,a=(p=k(a,b,c)>k(d[f],d[f+1],d[f+2])?!0:!1)?a:d[f],b=p?b:d[f+1],c=p?c:d[f+2];return[a,b,c,e]})};a.darkermerge=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?
o.call(arguments,1):[];e=g(c,null);c=e[0];for(e=e[1];!e;)return!1;d=a.getToolbox(a.hardResize(e,b.width,b.height))[3];return a.rgba(b,c,function(a,b,c,e,f){var g,a=(g=k(a,b,c)<k(d[f],d[f+1],d[f+2])?!0:!1)?a:d[f],b=g?b:d[f+1],c=g?c:d[f+2];return[a,b,c,e]})};a.blend=function(){var b,c,d,f,h,j,i;c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];i=g(d,null,0.5);d=i[0];j=i[1];for(b=i[2];!j;)return!1;h=a.getToolbox(a.hardResize(j,c.width,c.height))[3];f=1-b;return a.rgba(c,d,function(a,d,c,g,
i){a=e(a*f+h[i]*b);d=e(d*f+h[i+1]*b);c=e(c*f+h[i+2]*b);return[a,d,c,g]})};a.viewfinder=function(e,c){var d;b(c,"Franz.viewfinder");d=new Image;d.onload=function(){return a.merge(e,d,c)};d.src=Franzdataurls.viewfinder;return!0};a.oldschool=function(e,c){var d;b(c,"Franz.oldschool");d=new Image;d.onload=function(){return a.lightermerge(e,d,c)};d.src=Franzdataurls.oldschool;return!0};a.many=function(){var e,c,d,f,h,i,j;d=arguments[0];e=2<=arguments.length?o.call(arguments,1):[];e=g(e);f=e[0];c=e[1];
i=e[2];b(f);e=null!=(h=null!=c?c.shift():void 0)?h:null;for(h=null!=(j=null!=i?i.shift():void 0)?j:[];!Array.isArray(h);)h=[h];return 0<c.length?e.apply(null,[d,function(b){return a.many(b,f,c,i)}].concat(o.call(h))):e(d,f,h)};a.fill=function(){var b,c,d,f,h,i;c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];i=g(d,0,0,0);d=i[0];h=i[1];f=i[2];b=i[3];return a.rgba(c,d,function(a,d,c,g){return[e(h),e(f),e(b),g]})};a.rgbaAd=function(){var b,c,d,f,h,i,j;d=arguments[0];f=2<=arguments.length?
o.call(arguments,1):[];j=g(f,0,0,0,0);f=j[0];i=j[1];h=j[2];c=j[3];b=j[4];return a.rgba(d,f,function(a,d,f,g){return[e(g+i),e(d+h),e(f+c),e(g+b)]})};a.adBrighter=function(){var b,c,d;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];d=g(c,0);c=d[0];d=d[1];return a.rgbaAd(b,d,d,d,0,c)};a.adDarker=function(){var b,c;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];c=g(c,0);return a.brighter(b,-1*c[1],c[0])};a.adOpacity=function(){var b,c;b=arguments[0];c=2<=arguments.length?o.call(arguments,
1):[];c=g(c,0);return a.rgbaAd(b,0,0,0,c[1],c[0])};a.rgbaMultiply=function(){var b,c,d,f,h,i;d=arguments[0];f=2<=arguments.length?o.call(arguments,1):[];i=g(f,1,1,1,1);f=i[0];h=i[2];c=i[3];b=i[4];return a.rgba(d,f,function(a,d,f,g){return[e(g*b),e(d*h),e(f*c),e(g*b)]})};a.brighter=function(){var b,c,d;b=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];d=g(d,1);c=d[0];d=d[1];return a.rgbaMultiply(b,d,d,d,1,c)};a.darker=function(){var b,c,d;b=arguments[0];d=2<=arguments.length?o.call(arguments,
1):[];d=g(d,1);c=d[0];d=d[1];d=2-d;return a.rgbaMultiply(b,d,d,d,1,c)};a.opacity=function(){var b,c;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];c=g(c,1);return a.rgbaMultiply(b,1,1,1,c[1],c[0])};a.threshold=function(){var b,c,d,e;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];e=g(c,128);c=e[0];d=e[1];return a.rgba(b,c,function(a,c,e,f){b=a>d||c>d||e>d?255:0;return[b,b,b,f]})};a.schemer=function(){var b,c,d,f,h,i,k,l,n,m,q;h=arguments[0];i=2<=arguments.length?o.call(arguments,
1):[];j(g(i,1,2,3,4,5,6,7,8,[],[]));k=g(i,[],[],[],[],[],[],[],[]);i=k[0];m=k[1];l=k[2];d=k[3];b=k[4];q=k[5];n=k[6];f=k[7];c=k[8];k=function(a,b){return a-b};m=m.sort(k);j(m);l=l.sort(k);d=d.sort(k);b=b.sort(k);return a.rgba(h,i,function(a,g,h,i){var j,k,t,o,u,r,C,w,P,M,O,R;j=[a,g,h,i];u=j[0];t=j[1];k=j[2];j=j[3];if(0<m.length){o=C=0;for(O=m.length;C<O;o=++C)if(r=m[o],a<=r){u=null!=(w=q[o])?w:r;break}}if(0<l.length){o=w=0;for(r=l.length;w<r;o=++w)if(a=l[o],g<=a){t=null!=(P=n[o])?P:a;break}}if(0<d.length){o=
P=0;for(a=d.length;P<a;o=++P)if(g=d[o],h<=g){k=null!=(M=f[o])?M:g;break}}if(0<b.length){o=M=0;for(g=b.length;M<g;o=++M)if(h=b[o],i<=h){j=null!=(R=c[o])?R:h;break}}return[e(u),e(t),e(k),e(j)]})};a.reduceAndReplace=function(){var b,c,d,e,f,h;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];d={c64:[[0,0,0],[255,255,255],[116,67,53],[124,172,186],[123,72,144],[100,151,79],[64,50,133],[191,205,122],[123,91,47],[79,69,0],[163,114,101],[80,80,80],[120,120,120],[164,215,142],[120,106,189],[159,
159,159]]};f=g(c,d.c64);c=f[0];f=f[1];Array.isArray(f)||(f=d[f]);e=f.length;j(f);h=f.sort(function(a,b){return(3*a[0]+4*a[1]+a[2]>>>3)-(3*b[0]+4*b[1]+b[2]>>>3)});j(h);return a.rgba(b,c,function(a,b,d,c){a=h[Math.floor((3*a+4*b+d>>>3)/256*e)];return[a[0],a[1],a[2],c]})};a.ascii=function(){var a,b;a=2<=arguments.length?o.call(arguments,1):[];return b=g(a,"@GLftli;:,.  "),b};a.applyIfRgba=function(b,c,d,e,f){var g;g=a.copy(b);g=a.getToolbox(g)[0];return a.many(b,[c],[d],function(b){var d,c;c=a.getToolbox(b);
b=c[0];d=c[3];a.newToolbox(b);return a.rgba(g,f,function(a,b,c,f,g){return e(a,b,c,f,g)?[d[g],d[g+1],d[g+2],d[g+3]]:[a,b,c,f,g]})})};a.posterize=function(){var b,c,d,f;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];f=g(c,5);c=f[0];d=Math.floor(255/f[1]);return a.rgby(b,c,function(a,b,c,f){a=e(Math.floor(a/d)*d);b=e(Math.floor(b/d)*d);c=e(Math.floor(c/d)*d);return[a,b,c,f]})};a.grayScale=function(a,b){return doRgbaFilter(a,b,function(a,b,c,e){a=(a+b+c)/3;return[a,a,a,e]})};a.tint=function(){var b,
c,d,f,h,i,j,k,l;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];l=g(c,85,85,85,170,170,170);c=l[0];k=l[1];j=l[2];i=l[3];h=l[4];d=l[5];f=l[6];k===h&&(h+=1);j===f&&(f+=1);i===d&&(d+=1);return a.rgba(b,c,function(a,b,c,g){a=e((a-k)*(255/(h-k)));b=e((b-k)*(255/(f-j)));c=e((c-i)*(255/(d-i)));return[a,b,c,g]})};a.sepia=function(b,c){return a.rgba(b,c,function(a,b,c,f){var g,h;h=0.349*a+0.686*b+0.168*c;g=0.272*a+0.534*b+0.131*c;return[e(0.393*a+0.769*b+0.189*c),e(h),e(g),f]})};a.blackWhite=function(b,
c){return a.rgba(b,c,function(a,b,c,e){a=0.3*a+0.59*b+0.11*c;return[a,a,a,e]})};a.solarize=function(b,c){return a.rgba(b,c,function(a,b,c,e){return[127<a?255-a:a,127<b?255-b:b,127<c?255-c:c,e]})};a.removeNoise=function(){var b,c,d,e,f,h,j,k,l,m,q,r,z,B,A,v,J,Q,N,H,K,L,w;h=arguments[0];j=2<=arguments.length?o.call(arguments,1):[];j=g(j)[0];v=n(h);h=v[0];v=v[3];q=[h.width,h.height];h=q[0];q=q[1];H=new Uint8Array(new ArrayBuffer(v.length));for(L=0;L<q;){J=L===q?L:L+1;Q=0===L?0:L-1;K=0;for(w=L*h;K<h;)b=
4*(w+K),c=K===h?K:K+1,f=4*(J*h+c),d=4*(Q*h+c),N=b,k=b+1,c=b+2,b+=3,A=z=v[d],r=v[N-4],B=v[N+4],e=v[f],r<A&&(A=r),B<A&&(A=B),e<A&&(A=e),r>z&&(z=r),B>z&&(z=B),e>z&&(z=e),B=r=v[d+1],e=v[k-4],l=v[k+4],m=v[f+1],e<B&&(B=e),l<B&&(B=l),m<B&&(B=m),e>r&&(r=e),l>r&&(r=l),m>r&&(r=m),m=l=v[d+2],d=v[c-4],e=v[c+4],f=v[f+2],d<m&&(m=d),e<m&&(m=e),f<m&&(m=f),d>l&&(l=d),e>l&&(l=e),f>l&&(l=f),N>z?H[N]=z:N<A&&(H[N]=A),k>r?H[k]=r:k<B&&(H[k]=B),c>l?H[c]=l:c<m&&(H[c]=m),H[b]=v[b],K+=1;L+=1}v=a.byArray(H,h,q);return i(j,v)};
a.nothing=function(){var b,c;b=arguments[0];c=2<=arguments.length?o.call(arguments,1):[];c=g(c)[0];return a.rgba(b,c,function(a,b,c,e){return[a,b,c,e]})};a.curve=function(){var b,c,d,e,f,h;c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];h=g(d,[0,0,0,1,1,2,3,3,3,4,4,4,5,5,5,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,10,11,11,12,12,12,12,13,13,13,14,14,15,15,16,16,17,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,44,45,47,48,49,52,54,55,57,59,60,62,65,67,69,
70,72,74,77,79,81,83,86,88,90,92,94,97,99,101,103,107,109,111,112,116,118,120,124,126,127,129,133,135,136,140,142,143,145,149,150,152,155,157,159,162,163,165,167,170,171,173,176,177,178,180,183,184,185,188,189,190,192,194,195,196,198,200,201,202,203,204,206,207,208,209,211,212,213,214,215,216,218,219,219,220,221,222,223,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,244,245,245,245,246,247,247,248,248,249,249,249,250,251,251,
252,252,252,253,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],[0,0,1,2,2,3,5,5,6,7,8,8,10,11,11,12,13,15,15,16,17,18,18,19,21,22,22,23,24,26,26,27,28,29,31,31,32,33,34,35,35,37,38,39,40,41,43,44,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,83,84,85,86,88,89,90,92,93,94,95,96,97,100,101,102,103,105,106,107,108,109,111,113,114,115,117,118,119,120,122,123,124,126,127,
128,129,131,132,133,135,136,137,138,140,141,142,144,145,146,148,149,150,151,153,154,155,157,158,159,160,162,163,164,166,167,168,169,171,172,173,174,175,176,177,178,179,181,182,183,184,186,186,187,188,189,190,192,193,194,195,195,196,197,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,226,227,228,228,229,230,231,232,232,232,233,234,235,235,236,236,237,238,238,239,239,240,240,241,242,242,242,243,244,245,245,246,246,247,
247,248,249,249,249,250,251,251,252,252,252,253,254,255],[53,53,53,54,54,54,55,55,55,56,57,57,57,58,58,58,59,59,59,60,61,61,61,62,62,63,63,63,64,65,65,65,66,66,67,67,67,68,69,69,69,70,70,71,71,72,73,73,73,74,74,75,75,76,77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,93,93,94,94,95,95,96,97,98,98,99,99,100,101,102,102,103,104,105,105,106,106,107,108,109,109,110,111,111,112,113,114,114,115,116,117,117,118,119,119,121,121,122,122,123,124,125,126,126,127,128,129,129,
130,131,132,132,133,134,134,135,136,137,137,138,139,140,140,141,142,142,143,144,145,145,146,146,148,148,149,149,150,151,152,152,153,153,154,155,156,156,157,157,158,159,160,160,161,161,162,162,163,164,164,165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,177,178,178,179,180,180,181,181,181,182,182,183,184,184,184,185,185,186,186,186,187,188,188,188,189,189,189,190,190,191,191,192,192,193,193,193,194,194,194,195,196,196,196,197,197,197,198,199]);d=h[0];f=h[1];
e=h[2];b=h[3];return a.rgba(c,d,function(a,c,d,g){return[f[a],e[c],b[d],g]})};a.screen=function(){var b,c,d,e,f,h,i;c=arguments[0];d=2<=arguments.length?o.call(arguments,1):[];i=g(d,227,12,169,0.2);d=i[0];f=i[1];e=i[2];b=i[3];h=i[4];return a.rgba(c,d,function(a,c,d,g){return[255-(255-a)*(255-f*h)/255,255-(255-c)*(255-e*h)/255,255-(255-d)*(255-b*h)/255,g]})};l=function(){var a,b,d,e,f,g,h;a=arguments[0];b=arguments[1];d=arguments[2];g=4<=arguments.length?o.call(arguments,3):[];h=n(a);a=h[0];e=h[2];
h=r(a);a=h[0];f=h[1];i(function(){return f.putImageData(d.apply(null,[e].concat(o.call(g))),0,0)});return i(b,a)};h=function(){var a,b;b=arguments[0];a=2<=arguments.length?o.call(arguments,1):[];return function(){var d,e,f;d=arguments[0];e=2<=arguments.length?o.call(arguments,1):[];f=g(e,a);e=f.shift();return l.apply(null,[d,e,b].concat(o.call(f)))}};a.binarize=h(ImageFilters.Binarize,0.5);a.boxBlur=h(ImageFilters.BoxBlur,3,3,2);a.gaussianBlur=h(ImageFilters.GaussianBlur,2);a.stackBlur=h(ImageFilters.StackBlur,
6);a.brightness=h(ImageFilters.brightness,1);a.brightnessConstrastGimp=h(ImageFilters.BrightnessContrastGimp,50,50);a.brightnessConstrastPhotoshop=h(ImageFilters.BrightnessContrastPhotoshop,50,50);a.Channels=function(a){return h(ImageFilters.Channels,"blue"===a||"b"===a?3:"green"===a||"g"===a?2:a)};a.colorTransform=h(ImageFilters.ColorTransformFilter,1,1,1,0,0,0);a.dither=h(ImageFilters.Dither,2);a.edge=h(ImageFilters.Edge);a.emboss=h(ImageFilters.Emboss);a.enrich=h(ImageFilters.Enrich);a.gamma=h(ImageFilters.Gamma,
2);a.HSLAdjustment=h(ImageFilters.HSLAdjustment,0,0,0);a.invert=h(ImageFilters.Invert);a.mosaic=h(ImageFilters.Mosaic,10);a.oil=h(ImageFilters.Oil,4,30);a.sharpen=h(ImageFilters.Sharpen,3);a.twirl=h(ImageFilters.Twril,0.5,0.5,100,360);window.Franz=a}).call(this);
